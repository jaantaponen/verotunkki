{"version":3,"sources":["components/Dropzone.tsx","components/Copyright.tsx","components/Frontpage.tsx","utils/parsers/translations.ts","utils/parsers/types.ts","utils/parsers/helpers.ts","utils/parsers/loadTransactions.ts","components/tableSettings.tsx","components/ResultTable.tsx","utils/fifo/fifo.ts","components/Securities.tsx","components/Crypto.tsx","index.tsx"],"names":["Dropzone","zoneHeight","handleFiles","Container","sx","pt","pb","width","color","paddingTop","fontSize","height","acceptedFiles","onAdd","onDelete","fileObj","console","log","onAlert","message","variant","Icon","UploadFileIcon","dropzoneText","fileObjects","Copyright","Stack","direction","justifyContent","alignItems","spacing","Typography","alignSelf","align","component","Link","href","Date","getFullYear","FrontPageContent","navigate","useNavigate","theme","createTheme","typography","ThemeProvider","GlobalStyles","styles","ul","margin","padding","listStyle","CssBaseline","maxWidth","gutterBottom","fontWeight","Card","onClick","CardActionArea","CardContent","degiroFiToEn","translateDegiro","key","CoinBaseProHeaderValues","CoinBaseHeaderValues","DegiroHeaderValues","NordnetHeaderValues","decodeUTF16LE","binaryStr","cp","i","length","push","charCodeAt","String","fromCharCode","chooseCSVParser","filesCopy","parsers","a","errors","inputFile","data","toString","split","fileContentBuffer","name","atob","str","decodeURIComponent","escape","window","fileContent","parsedData","Source","Error","find","e","TypeError","loadParser","parse","parseDegiroCSV","input","prevField","tmp","cast","value","context","header","columns","trim","results","record","records","map","transaction","moment","date","time","toDate","every","x","_","difference","sortBy","Object","keys","parseNordNetCSV","delimiter","includes","replace","column","Number","parseFloat","getNordnetAsColumns","paivays","Kauppapaiva","toUTCString","tuote","Arvopaperi","isin","ISIN","arvo","Summa","Valuutta","maara","Maara","kulut","Kokonaiskulut","kurssi","Kurssi","kokonaissumma","parseCoinbaseCSV","startAt","findIndex","o","startsWith","tz","toUpperCase","from_line","parseCoinbaseProCSV","product","pricefeetotalunit","undefined","getCoinbaseProAsColumns","createdat","toLocaleString","timeZone","size","price","fee","toFixed","total","operaatio","side","columnsTransaction","id","label","minWidth","format","columnsSecurity","columnsCrypto","ResultTable","rows","mode","useState","page","setPage","rowsPerPage","setRowsPerPage","useEffect","scrollTo","Paper","overflow","TableContainer","maxHeight","Table","stickyHeader","TableHead","TableRow","TableCell","style","TableBody","slice","row","index","hover","role","tabIndex","TablePagination","rowsPerPageOptions","count","onPageChange","event","newPage","onRowsPerPageChange","target","calculateFIFOTransactions","operationHistory","history","obj","filter","type","reduce","capitalGainPerSellDate","sale","calculateCapitalGainsForSale","calculateFIFOCapitalGains","flatMap","gainByDate","totalAmount","sumBy","transactions","amountsold","dividedFees","transferFee","transferFeeForSell","transferFeeSummedFromSELLOperation","error","ticker","relatedBuyTransactions","symbol","orderBy","forEach","buy","amountSold","Math","min","amount","trs","buydate","selldate","transferPrice","profitOrLoss","acquisitionPrice","acquisitionFee","transactionFee","totalPrice","round","Securities","setZoneHeight","files","setFiles","showTable","setShowTable","rawData","setRawData","setResults","dataSource","setDataSource","setRows","parseError","errorFifo","setErrorFifo","tmpResult","setTmpResult","degiroColumns","datetime","security","valueCurrency","quantity","transactionCosts","rate","rateCurrency","totalAmountCurrency","nordnetColumns","Alert","severity","file","pl","Button","startIcon","disabled","fifoData","max","prepareDegiroForFIFO","Tapahtumatyyppi","prepareNordnetForFIFO","toISOString","substring","endIcon","Crypto","setParseError","msg","coinBaseColumns","Subtotal","QuantityTransacted","SpotPriceatTransaction","SpotPriceCurrency","Timestamp","Asset","Fees","Total","TransactionType","rawcopy","Coinbase","currencyError","coinBaseProColumns","CoinbasePro","prepareRawFifo","statement","info","Notes","boughAmount","boughtCurrency","concat","prepareCoinbaseForFIFO","prepareCoinbaseProForFIFO","finalFifo","ReactDOM","render","basename","process","path","element","document","getElementById"],"mappings":"0LAYMA,EAAW,SAAC,GAAwC,IAAtCC,EAAqC,EAArCA,WAAYC,EAAyB,EAAzBA,YAW5B,OACI,cAACC,EAAA,EAAD,CAAWC,GAAI,CACXC,GAAI,EAAGC,GAAI,EACXC,MAAO,OACP,mCAAoC,CAChCC,MAAO,SAEX,0BAA2B,CACvBC,WAAYR,EAAa,IAAM,EAAI,EACnCS,SAAU,IAEd,0BAA2B,CACvBC,OAAQV,IAXhB,SAcI,cAAC,IAAD,CACIW,cAAe,CAAC,aAAc,aAAc,4BAC5CC,MAAOX,EACPY,SAAU,SAACC,GAAD,OAAaC,QAAQC,IAAI,gBAAiBF,IACpDG,QA3BQ,SAACC,EAAcC,GAC/BJ,QAAQC,IAAR,UAAeG,EAAf,aAA2BD,KA2BnBE,KAAMC,IACNC,aAActB,EAAa,IAAM,oCAAgC,gDACjEuB,YAAa,Q,uECzCvBC,EAAY,WACd,OACI,eAACC,EAAA,EAAD,CACIC,UAAU,SACVC,eAAe,SACfC,WAAW,SACXC,QAAS,EACTvB,MAAO,KACPH,GAAI,CAAEC,GAAI,GANd,UAQI,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASC,UAAU,IAAI9B,GAAI,CAAEC,GAAI,GAAtE,0DAGA,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASC,UAAU,IAAI9B,GAAI,CAAEC,GAAI,GAAtE,qGAGA,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASC,UAAU,IAAI9B,GAAI,CAAEC,GAAI,GAAtE,+GAGA,eAAC0B,EAAA,EAAD,CAAYX,QAAQ,QAAQhB,GAAI,CAAEC,GAAI,GAAKG,MAAM,iBAAiByB,MAAM,SAAxE,UACK,kBACD,cAACE,EAAA,EAAD,CAAM3B,MAAM,UAAU4B,KAAK,yBAA3B,wBAEQ,KACP,IAAIC,MAAOC,cACX,W,2BCdXC,EAAmB,WACrB,IAAMC,EAAWC,cACXC,EAAQC,YAAY,CACtBC,WAAY,CACRlC,SAAU,MAGlB,OACI,eAACmC,EAAA,EAAD,CAAeH,MAAOA,EAAtB,UACI,cAACI,EAAA,EAAD,CAAcC,OAAQ,CAAEC,GAAI,CAAEC,OAAQ,EAAGC,QAAS,EAAGC,UAAW,WAChE,cAACC,EAAA,EAAD,IACA,eAACjD,EAAA,EAAD,CAAW+B,UAAU,OAAOmB,SAAS,KAAKjD,GAAI,CAAEC,GAAI,EAAGC,GAAI,GAA3D,UACI,eAACoB,EAAA,EAAD,CACIC,UAAU,SACVC,eAAe,SACfC,WAAW,SACXC,QAAS,EACTvB,MAAM,KALV,UAQI,cAACwB,EAAA,EAAD,CACIG,UAAU,KACVd,QAAQ,KACRa,MAAM,SACNzB,MAAM,eACN8C,cAAY,EACZlD,GAAI,CAAEmD,WAAY,OAAQlD,GAAI,GANlC,wBAUA,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASb,QAAQ,KAAKhB,GAAI,CAAEC,GAAI,GAAK6B,UAAU,IAApF,0IAIA,cAACH,EAAA,EAAD,CAAYC,UAAU,SAASZ,QAAQ,KAAKc,UAAU,IAAI9B,GAAI,CAAEC,GAAI,GAApE,gDAGA,cAACmD,EAAA,EAAD,CAAMpD,GAAI,CAAEG,MAAO,KAAOkD,QAAS,WAC/BjB,EAAS,YADb,SAGI,cAACkB,EAAA,EAAD,UACI,eAACC,EAAA,EAAD,WACI,cAAC5B,EAAA,EAAD,CAAYuB,cAAY,EAAClC,QAAQ,KAAKc,UAAU,MAAhD,+BAGA,cAACH,EAAA,EAAD,CAAYX,QAAQ,QAAQZ,MAAM,iBAAlC,qCAGA,eAACuB,EAAA,EAAD,CAAYX,QAAQ,QAAQZ,MAAM,iBAAlC,gCACoB,iEAKhC,cAACgD,EAAA,EAAD,CAAMpD,GAAI,CAAEG,MAAO,KAAOkD,QAAS,WAC/BjB,EAAS,gBADb,SAGI,cAACkB,EAAA,EAAD,UACI,eAACC,EAAA,EAAD,WACI,cAAC5B,EAAA,EAAD,CAAYuB,cAAY,EAAClC,QAAQ,KAAKc,UAAU,MAAhD,yBAGA,cAACH,EAAA,EAAD,CAAYX,QAAQ,QAAQZ,MAAM,iBAAlC,2DAGA,eAACuB,EAAA,EAAD,CAAYX,QAAQ,QAAQZ,MAAM,iBAAlC,gCACoB,6DAMpC,cAAC,EAAD,W,2ECvFVoD,EAAe,CACjB,gBAAW,OACX,KAAQ,OACR,MAAS,WACT,KAAQ,OACR,UAAa,YACb,MAAS,QACT,SAAY,WACZ,OAAU,OACV,kBAAmB,eACnB,gBAAiB,cACjB,yBAA0B,sBAC1B,MAAS,QACT,iBAAkB,gBAClB,aAAgB,eAChB,oBAAqB,mBACrB,6BAA8B,2BAC9B,cAAiB,cACjB,yBAA0B,sBAC1B,WAAY,WASDC,EANS,SAACC,GACrB,GAAIF,EAAaE,GACb,OAAOF,EAAaE,I,iBC+DfC,G,OAA0B,CACrC,YACA,UACA,UACA,OACA,YACA,OACA,WACA,QACA,MACA,QACA,sBAGWC,EAAuB,CAClC,YACA,kBACA,QACA,qBACA,oBACA,yBACA,WACA,QACA,OACA,SAGWC,EAAqB,CAChC,OACA,OACA,WACA,OACA,YACA,QACA,WACA,OACA,eACA,cACA,sBACA,QACA,gBACA,eACA,mBACA,2BACA,cACA,sBACA,UACA,YAGWC,EAAsB,CACjC,KAAM,eACN,cAAe,aACf,SAAU,kBACV,aAAc,qBACd,OAAQ,QACR,SAAU,QACV,gBAAiB,wBACjB,QAAS,WACT,eAAgB,QAChB,gBAAiB,QACjB,eAAgB,kBAChB,kBAAmB,WACnB,kBAAmB,iBACnB,0B,iBC/IIC,EAAgB,SAACC,GAEnB,IADA,IAAMC,EAAK,GACFC,EAAI,EAAGA,EAAIF,EAAUG,OAAQD,GAAK,EACvCD,EAAGG,KAAKJ,EAAUK,WAAWH,GAAMF,EAAUK,WAAWH,EAAI,IAAM,GACtE,OAAOI,OAAOC,aAAP,MAAAD,OAAuBL,IAQ5BO,EAAe,uCAAG,WAAOC,EAAyBC,GAAhC,2BAAAC,EAAA,sDACdC,EAAkB,GACfV,EAAI,EAFO,YAEJA,EAAIQ,EAAQP,QAFR,iCAINU,EAAYJ,EAAU,GAAGK,KAAOL,EAAU,GAAGK,KAAKC,WAAWC,MAAM,KAAK,GAAK,GAC7EC,EAAwC,oBAApBP,EAAQR,GAAGgB,KAA6BnB,EAAcoB,KAAKN,KAnB5EO,EAmBsGP,EAnBrFQ,mBAAmBC,OAAOC,OAAOJ,KAAKC,MAoB1DI,EAAcP,EAAkBF,WAN1B,SAOaL,EAAQR,GAAGsB,GAPxB,cAONC,EAPM,yBAQLA,GARK,kCAUZb,EAAOR,KAAP,MAVY,QAEgBF,IAFhB,gDAab,CAAC,CAAEwB,OAAQ,QAASC,MAAK,UAAGf,EAAOgB,MAAK,SAAAC,GAAC,OAAKA,aAAaC,oBAAlC,QAAiDlB,EAAO,MAbpE,kCAdJ,IAACQ,IAcG,qBAAH,wDAqBfW,EAAe,uCAAG,sBAAApB,EAAA,wFAGoBqB,MAHpB,sCAIb,8BAJa,mBAIgBA,MAJhB,kFAAH,qDC/BfC,EAAc,uCAAG,WAAOC,GAAP,mCAAAvB,EAAA,6DACfwB,EAAY,GADG,SAECJ,IAFD,OAEbC,EAFa,OAGbI,EAAMJ,EAAME,EAAO,CACrBG,KAAM,SAACC,EAAYC,GACf,OAAIA,EAAQC,OACM,KAAVF,EAAqB7C,EAAgB,GAAD,OAAI0C,EAAJ,eACxCA,EAAYG,EACL7C,EAAgB6C,IAEpBhC,OAAOgC,IAElBG,SAAS,EACTC,MAAM,IAGJC,EAAU,GAhBG,iCAiBQP,GAjBR,oFAiBFQ,EAjBE,QAkBfD,EAAQvC,KAAKwC,GAlBE,sTAqBbC,EAA2BF,EAAQG,KAAI,SAACC,GAE1C,OADAA,EAAW,SAAeC,IAAO,GAAD,OAAID,EAAYE,KAAhB,YAAwBF,EAAYG,MAAQ,oBAAoBC,SACzFJ,MAGPJ,EAAQS,OAAM,SAAAC,GAAC,OAAoF,IAAhFC,IAAEC,WAAWD,IAAEE,OAAO3D,GAAqByD,IAAEE,OAAOC,OAAOC,KAAKL,KAAKlD,UA1BzE,uBA2BT2B,UAAU,sDA3BD,iCA8BZe,EAAQC,KAAI,SAAAO,GAAC,kCACbA,GADa,IACV,OAAU,eA/BD,4EAAH,sDAmEdM,EAAe,uCAAG,WAAOzB,GAAP,+BAAAvB,EAAA,sEACAoB,IADA,OACdC,EADc,OAEdI,EAAMJ,EAAME,EAAO,CACrB0B,UAAW,CAAC,MACZnB,SAAS,EACTC,MAAM,EACNL,KAAM,SAACC,EAAYC,GACf,GAAIA,EAAQC,OAAQ,CAChB,IAAIA,EAASF,EAIb,OAHIE,EAAOqB,SAAS,UAAMrB,EAASA,EAAOsB,QAAQ,QAAM,MACpDtB,EAAOqB,SAAS,UAAMrB,EAASA,EAAOsB,QAAQ,QAAM,MACpDtB,EAAOqB,SAAS,OAAMrB,EAASA,EAAOsB,QAAQ,KAAM,KACjDtB,EAAOsB,QAAQ,MAAO,IAEjC,IAAMC,EAASxB,EAAQwB,OAEvB,MAAe,UAAXA,GACW,WAAXA,GACW,mBAAXA,GACW,UAAXA,GACW,kBAAXA,GACW,kBAAXA,EAAmCC,OAAOC,WAAW3B,EAAMwB,QAAQ,KAAM,MAC9D,iBAAXC,GACW,gBAAXA,GACW,eAAXA,EAAgCf,IAAOV,EAAO,cAAca,SACzD7C,OAAOgC,MAIhBK,EAAU,GA7BI,iCA8BOP,GA9BP,mFA8BHQ,EA9BG,QA+BhBD,EAAQvC,KAAKwC,GA/BG,sTAkChBD,EAAQS,OAAM,SAAAC,GAAC,OAA2E,IAAvEC,IAAEC,WAAWzD,EAAqBwD,IAAEE,OAAOC,OAAOC,KAAKL,KAAKlD,UAlC/D,uBAmCV2B,UAAU,uDAnCA,iCAsCba,EAAQG,KAAI,SAAAO,GAAC,kCACbA,GADa,IACV,OAAU,gBAvCA,4EAAH,sDA2Cfa,EAAsB,SAACrB,GAazB,OAZYA,EAAQC,KAAI,SAAAF,GACpB,MAAO,CACHuB,QAASvB,EAAOwB,YAAYC,cAC5BC,MAAO1B,EAAO2B,WACdC,KAAM5B,EAAO6B,KACbC,KAAK,GAAD,OAAK9B,EAAO+B,MAAZ,YAAqB/B,EAAOgC,UAChCC,MAAOjC,EAAOkC,MACdC,MAAOnC,EAAOoC,cACdC,OAAO,GAAD,OAAKrC,EAAOsC,OAAZ,YAAsBtC,EAAOgC,UACnCO,cAAc,GAAD,OAAKvC,EAAO+B,MAAQ/B,EAAOoC,cAA3B,YAA4CpC,EAAOgC,eAuBtEQ,EAAgB,uCAAG,WAAOlD,GAAP,mBAAAvB,EAAA,6DACf0E,EAAU/B,IAAEgC,UAAF,OAAYpD,QAAZ,IAAYA,OAAZ,EAAYA,EAAOlB,MAAM,OAAO,SAACuE,GAAD,cAAOA,QAAP,IAAOA,OAAP,EAAOA,EAAGC,WAAW,4BADhD,SAEDzD,IAFC,UAEfC,EAFe,SAkBjB,QAfEW,EAAUX,EAAME,EAAO,CACzBG,KAAM,SAACC,EAAYC,GACf,OAAIA,EAAQC,OACJF,EAAMuB,SAAS,KAAavB,EAAMtB,MAAM,KAAK,GAAG8C,QAAQ,MAAO,IAC5DxB,EAAMwB,QAAQ,MAAO,KAEhCd,IAAOyC,GACgB,cAAnBlD,EAAQwB,OAA+Bf,IAAOV,EAAO,oBAAoBmD,GAAG,mBAAmBtC,SAC5E,oBAAnBZ,EAAQwB,OAAqCzB,EAAMoD,cAChDpF,OAAOgC,KAElBG,SAAS,EACTkD,UAAWN,EAAU,EAAIA,EAAU,EAAI,EACvC3C,MAAM,WAEN,IAACC,IAAW,IAAIS,OAAM,SAACC,GAAD,OAAoF,IAAxEC,IAAEC,WAAW3D,EAAsB0D,IAAEE,OAAOC,OAAOC,KAAKL,KAAKlD,UAlB9E,sBAmBX2B,UAAU,wDAnBC,gCAsBda,EAAQG,KAAI,SAACO,GAAD,mBAAC,eACbA,GADY,IACT,OAAU,iBAvBC,2CAAH,sDAoGhBuC,EAAmB,uCAAG,WAAO1D,GAAP,+BAAAvB,EAAA,sEACJoB,IADI,OAClBC,EADkB,OAElBI,EAAMJ,EAAME,EAAO,CACrBG,KAAM,SAACC,EAAYC,GACf,OAAIA,EAAQC,OACJF,EAAMuB,SAAS,KAAavB,EAAMwB,QAAQ,MAAO,IAAIA,QAAQ,MAAO,IACjExB,EAAMwB,QAAQ,MAAO,IAET,cAAnBvB,EAAQwB,OAA+B,IAAI9F,KAAKqE,GAC7ChC,OAAOgC,IAElBG,SAAS,EACTC,MAAM,IAGJC,EAAU,GAfQ,iCAgBGP,GAhBH,mFAgBPQ,EAhBO,QAgBQD,EAAQvC,KAAKwC,GAhBrB,sTAmBpBD,EAAQS,OAAM,SAAAC,GAAC,OAAyF,IAArFC,IAAEC,WAAWD,IAAEE,OAAO7D,GAA0B2D,IAAEE,OAAOC,OAAOC,KAAKL,KAAKlD,UAnBzE,uBAoBd2B,UAAU,4DApBI,iCAwBjBa,EAAQG,KAAI,SAACO,GAAD,mBAAC,eACbA,GADY,IAEf3B,OAAQ,cACRmE,QAASxC,EAAEwC,QAAQ7E,MAAM,KAAK,GAC9BW,MAAgC,QAAxB0B,EAAEyC,kBAA8B,iCAA8BC,QA5BlD,4EAAH,sDAgCnBC,EAA0B,SAACnD,GAa7B,OAZYA,EAAQC,KAAI,SAAAF,GAAW,IAAD,IAC9B,MAAO,CACHuB,QAASvB,EAAOqD,UAAUC,eAAe,QAAS,CAAEC,SAAU,QAC9D7B,MAAO1B,EAAOiD,QACdnB,KAAK,GAAD,OAAK9B,EAAOwD,KAAOxD,EAAOyD,MAA1B,YAAmCzD,EAAOkD,mBAC9CjB,MAAOjC,EAAOwD,KACdrB,MAAM,GAAD,OAAKf,OAAM,UAACpB,EAAO0D,WAAR,QAAe,GAAGC,QAAQ,GAArC,YAA2C3D,EAAOkD,mBACvDb,OAAO,GAAD,OAAKrC,EAAOyD,MAAZ,YAAqBzD,EAAOkD,mBAClCX,cAAc,GAAD,OAAKnB,OAAM,UAACpB,EAAO4D,aAAR,QAAiB,GAAGD,QAAQ,GAAvC,YAA6C3D,EAAOkD,mBACjEW,UAAW7D,EAAO8D,U,+EC9QxBC,GAAmD,CACrD,CAAEC,GAAI,SAAUC,MAAO,QAASC,SAAU,KAC1C,CAAEF,GAAI,UAAWC,MAAO,sBAAiBC,SAAU,KACnD,CAAEF,GAAI,WAAYC,MAAO,sBAAiBC,SAAU,KACpD,CACIF,GAAI,aAAcC,MAAO,YAAaC,SAAU,IAChDC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,KAE7C,CAAEK,GAAI,gBAAiBC,MAAO,gBAAiBC,SAAU,KACzD,CACIF,GAAI,mBAAoBC,MAAO,gBAAiBC,SAAU,IAC1DC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,KAE7C,CAAEK,GAAI,iBAAkBC,MAAO,gBAAiBC,SAAU,KAC1D,CAAEF,GAAI,cAAeC,MAAO,gBAAiBC,SAAU,IACvD,CACIF,GAAI,eAAgBC,MAAO,gBAAiBC,SAAU,IACtDC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,MAK3CS,GAA6C,CAC/C,CAAEJ,GAAI,UAAWC,MAAO,UAAWC,SAAU,KAC7C,CAAEF,GAAI,QAASC,MAAO,QAASC,SAAU,KACzC,CAAEF,GAAI,OAAQC,MAAO,OAAQC,SAAU,KACvC,CACIF,GAAI,QAASC,MAAO,QAASC,SAAU,IACvCC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,KAE7C,CAAEK,GAAI,SAAUC,MAAO,SAAUC,SAAU,KAC3C,CAAEF,GAAI,OAAQC,MAAO,OAAQC,SAAU,KACvC,CAAEF,GAAI,QAASC,MAAO,QAASC,SAAU,KACzC,CAAEF,GAAI,gBAAiBC,MAAO,gBAAiBC,SAAU,MAGvDG,GAAyC,CAC3C,CAAEL,GAAI,UAAWC,MAAO,UAAWC,SAAU,KAC7C,CAAEF,GAAI,YAAaC,MAAO,YAAaC,SAAU,KACjD,CAAEF,GAAI,QAASC,MAAO,QAASC,SAAU,KACzC,CAAEF,GAAI,OAAQC,MAAO,OAAQC,SAAU,KACvC,CACIF,GAAI,QAASC,MAAO,iBAASC,SAAU,IACvCC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,KAE7C,CAAEK,GAAI,SAAUC,MAAO,SAAUC,SAAU,KAC3C,CACIF,GAAI,QAASC,MAAO,QAASC,SAAU,IACvCC,OAAQ,SAACzE,GAAD,OAAmBA,EAAMiE,QAAQ,KAE7C,CAAEK,GAAI,gBAAiBC,MAAO,gBAAiBC,SAAU,MClEvDI,GAAc,SAAC,GAA2B,IAAzBC,EAAwB,EAAxBA,KAAMC,EAAkB,EAAlBA,KAGzB,EAAwBC,mBAAS,GAAjC,mBAAOC,EAAP,KAAaC,EAAb,KACA,EAAsCF,mBAAS,IAA/C,mBAAOG,EAAP,KAAoBC,EAApB,KAEIhF,EAA8F,GACrF,aAAT2E,EACA3E,EAAUuE,GACM,WAATI,EACP3E,EAAUwE,GACM,WAATG,IACP3E,EAAUkE,IAed,OAJAe,qBAAU,WACNnG,OAAOoG,SAAS,EAAG,OACpB,IAEK,mCAAE,eAACC,EAAA,EAAD,CAAO5L,GAAI,CAAEG,MAAO,OAAQ0L,SAAU,UAAtC,UACN,cAACC,GAAA,EAAD,CAAgB9L,GAAI,CAAE+L,UAAW,MAAjC,SACI,eAACC,GAAA,EAAD,CAAOC,cAAY,EAAC,aAAW,eAA/B,UACI,cAACC,GAAA,EAAD,UACI,cAACC,GAAA,EAAD,UACK1F,EAAQK,KAAI,SAACiB,GAAD,OACT,cAACqE,GAAA,EAAD,CAEIvK,MAAOkG,EAAOlG,MACdwK,MAAO,CAAEvB,SAAU/C,EAAO+C,UAH9B,SAKK/C,EAAO8C,OAJH9C,EAAO6C,WAS5B,cAAC0B,GAAA,EAAD,UACKnB,EACIoB,MAAMjB,EAAOE,EAAaF,EAAOE,EAAcA,GAC/C1E,KAAI,SAAC0F,EAAKC,GACP,OACI,cAACN,GAAA,EAAD,CAAUO,OAAK,EAACC,KAAK,WAAWC,UAAW,EAA3C,SACKnG,EAAQK,KAAI,SAACiB,GACV,IAAMzB,EAASkG,EAAYzE,EAAO6C,IAClC,OACI,cAACwB,GAAA,EAAD,CAA2BvK,MAAOkG,EAAOlG,MAAzC,SACKkG,EAAOgD,QAA2B,kBAAVzE,EACnByB,EAAOgD,OAAOzE,GACdA,GAHMyB,EAAO6C,QAJgB6B,aAiB3E,cAACI,GAAA,EAAD,CACIC,mBAAoB,CAAC,GAAI,GAAI,KAC7BhL,UAAU,MACViL,MAAO5B,EAAKhH,OACZqH,YAAaA,EACbF,KAAMA,EACN0B,aAxDiB,SAACC,EAAgBC,GACtC3B,EAAQ2B,IAwDJC,oBAtDwB,SAACF,GAC7BxB,GAAgBwB,EAAMG,OAAO9G,OAC7BiF,EAAQ,Y,wCCiHT,IAAM8B,GAA4B,SAACC,GACxC,IAAM3I,EAlDD,SACL2I,GAEA,IAAMC,EAAUD,EAAiBxG,KAAI,SAAC0G,GAAD,sBAAeA,MAGpD,OAFcD,EAAQE,QAAO,kBAAuB,SAAvB,EAAGC,QAEnBC,QACX,SAACC,EAAwBC,GAAzB,4BACKD,GADL,CAEEE,GAA6BP,EAASM,OAExC,IAuCQE,CAA0BT,GAAkBU,SAAQ,SAACC,GAC7D,IAO+D,EAPzDC,EAAc5G,IAAE6G,MAAMF,EAAWG,cAAc,SAAC7E,GAAD,OAAOA,EAAE8E,cACxDC,EAAcL,EAAWG,aAAatH,KAAI,SAAAO,GAAC,kCAC5CA,GAD4C,IAE/CkH,YAAclH,EAAEgH,WAAaH,EAAe7G,EAAEkH,iBAE1CC,EAAqBP,EAAWG,aAAa,GAAKH,EAAWG,aAAa,GAAGG,YAAc,EAC3FE,EAAqCnH,IAAE6G,MAAMG,GAAa,SAAC/E,GAAD,OAAOA,EAAEgF,eACrEC,IAAuBC,GACzB7N,QAAQ8N,MAAR,wDAAqDT,EAAWG,aAAa,UAA7E,aAAqD,EAA4BO,OAAjF,aAA4FH,EAA5F,gBAAsHC,IAExH,OAAOH,KAET,OAAO3J,GAIHmJ,GAA+B,SACnCR,EACAO,GAEA,IAAID,EAAyB,EACvBQ,EAA8B,GAE9BQ,EAAyBtB,EAAiBG,QAC9C,gBAAGC,EAAH,EAAGA,KAAMmB,EAAT,EAASA,OAAQ5H,EAAjB,EAAiBA,KAAjB,MACW,QAATyG,GAAkBmB,IAAWhB,EAAKgB,QAAU5H,EAAO4G,EAAK5G,QAgC5D,GA5BAK,IAAEwH,QAAQF,GAAwB,SAACrF,GAAD,OAAkBA,EAAEtC,OAAM,OAAO8H,SACjE,SAACC,GACC,IAAMC,EAAaC,KAAKC,IAAItB,EAAKuB,OAAQJ,EAAII,QAE7C,GAAmB,IAAfH,EAAJ,CACA,IAAMI,EAAmB,CACvBV,OAAQd,EAAKgB,OACbS,QAASN,EAAI/H,KACbsI,SAAU1B,EAAK5G,KACfoH,WAAYY,EACZO,cAAe3B,EAAKxD,MACpBoF,aAAcR,GAAcpB,EAAKxD,MAAQ2E,EAAI3E,OAC7CqF,iBAAkBV,EAAI3E,MACtBsF,eAAgBX,EAAIY,eACpBrB,YAAaV,EAAK+B,gBAEpBxB,EAAahK,KAAKiL,GAElBL,EAAII,QAAUH,EACdpB,EAAKuB,QAAUH,EAEf,IAAMY,EACJZ,GAAcpB,EAAKxD,MAAQ2E,EAAI3E,OACjCuD,GAA0BiC,MAK1BX,KAAKY,MAAMjC,EAAKuB,QAAU,EAC5B,MAAMzJ,MAAM,8BAAD,OACqBkI,EAAKgB,OAD1B,0CACkEhB,EAAKuB,OADvE,oCACyG,IAAInN,KAAK4L,EAAK5G,MAC7HiD,eAAe,QAAS,CAAEC,SAAU,UAI3C,MAAO,CACLyD,yBACAQ,aAAcA,IC9LZ1J,GAAU,CAACuB,EAAgB0B,GAE3BoI,GAAa,WACf,MAAoC1E,mBAAS,KAA7C,mBAAOxL,EAAP,KAAmBmQ,EAAnB,KACA,EAA0B3E,mBAAuB,IAAjD,mBAAO4E,EAAP,KAAcC,EAAd,KACA,EAAkC7E,oBAAS,GAA3C,mBAAO8E,EAAP,KAAkBC,EAAlB,KACA,EAA8B/E,mBAA6C,IAA3E,mBAAOgF,EAAP,KAAgBC,EAAhB,KACA,EAA8BjF,mBAAkC,IAAhE,mBAAO1E,EAAP,KAAgB4J,EAAhB,KACA,EAAoClF,qBAApC,mBAAOmF,EAAP,KAAmBC,EAAnB,KACA,EAAwBpF,mBAA+B,IAAvD,mBAAOF,EAAP,KAAauF,EAAb,KACA,EAAoCrF,mBAAS,IAA7C,mBAAOsF,EAAP,KACA,GADA,KACkCtF,mBAAS,KAA3C,mBAAOuF,GAAP,KAAkBC,GAAlB,KAGA,GAAkCxF,mBAAS,GAA3C,qBAAOyF,GAAP,MAAkBC,GAAlB,MAWMzO,GAAQC,YAAY,CACtBC,WAAY,CACRlC,SAAU,MAuDlB,OA3BAoL,qBAAU,WACN,sBAAC,oCAAA/G,EAAA,2DACOsL,EAAM9L,OAAS,GADtB,uBAEO6L,EAAc,KACdI,GAAa,GAHpB,SAI0B5L,EAAgByL,EAAOvL,IAJjD,OAIaI,EAJb,OAM0B,YADb0L,EALb,UAK0B1L,EAAK,UAL/B,aAK0B,EAASY,SAExB+K,EAAc,UACRO,EAAmClM,EJrCrCgC,KAAI,SAAAF,GACpB,MAAO,CACHuB,QAASvB,EAAOqK,SAAS5I,cACzBC,MAAO1B,EAAOsK,SACd1I,KAAM5B,EAAO6B,KACbC,KAAK,GAAD,OAAK9B,EAAON,MAAZ,YAAqBM,EAAOuK,eAChCtI,MAAOjC,EAAOwK,SACdrI,MAAOnC,EAAOyK,iBACdpI,OAAO,GAAD,OAAKrC,EAAO0K,KAAZ,YAAoB1K,EAAO2K,cACjCpI,cAAc,GAAD,OAAKvC,EAAOsH,YAAZ,YAA2BtH,EAAO4K,yBI6BvClB,EAAW,GAAD,mBAAKD,GAAL,YAAiBvL,KAC3B4L,EAAQ,GAAD,mBAAKvF,GAAL,YAAc6F,KACrBhB,EAAc,KACdI,GAAa,IACS,YAAfI,IACPC,EAAc,WACRgB,EAAiBvJ,EAAoBpD,GAC3CwL,EAAW,GAAD,mBAAKD,GAAL,YAAiBvL,KAC3B4L,EAAQ,GAAD,mBAAKvF,GAAL,YAAcsG,KACrBzB,EAAc,KACdI,GAAa,IAnBxB,0CAAD,KAuBD,CAACH,IAIA,eAACxN,EAAA,EAAD,CAAeH,MAAOA,GAAtB,UACI,cAACI,EAAA,EAAD,CAAcC,OAAQ,CAAEC,GAAI,CAAEC,OAAQ,EAAGC,QAAS,EAAGC,UAAW,WAChE,cAACC,EAAA,EAAD,IACA,eAACjD,EAAA,EAAD,CAAW+B,UAAU,OAAO9B,GAAI,CAAEC,GAAI,EAAGC,GAAI,GAA7C,UACI,eAACoB,EAAA,EAAD,CACIC,UAAU,SACVC,eAAe,SACfC,WAAW,SACXC,QAAS,EACTvB,MAAM,KALV,UAQI,cAACwB,EAAA,EAAD,CACIG,UAAU,KACVd,QAAQ,KACRa,MAAM,SACNzB,MAAM,eACN8C,cAAY,EACZlD,GAAI,CAAEmD,WAAY,OAAQlD,GAAI,GANlC,wBAUA,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASb,QAAQ,KAAKhB,GAAI,CAAEC,GAAI,GAAK6B,UAAU,IAApF,yBAGC6O,GAAc,cAACe,EAAA,EAAD,CAAOC,SAAS,QAAhB,SAAyBhB,IACxC,cAAC,EAAD,CAAU9Q,WAAYA,EAAYC,YArF7B,SAAC8R,GAAD,OAAwB1B,EAAS0B,MAsFtC,cAACjQ,EAAA,EAAD,CAAYC,UAAU,aAAa5B,GAAI,CAAE6R,GAAI,GAAK/P,UAAU,IAA5D,gDAGC8O,IAAa,cAACc,EAAA,EAAD,CAAOC,SAAS,QAAhB,SAAyBf,KACtCT,GAAa,eAAC7O,EAAA,EAAD,CAAOC,UAAU,MAAMG,QAAS,EAAhC,UACV,cAACoQ,EAAA,EAAD,CAAQ9Q,QAAQ,WAAWqC,QAnG7B,WACd6M,EAAS,IACTQ,EAAQ,IACRJ,EAAW,IACXF,GAAa,GACbJ,EAAc,MA8FiD+B,UAAW,cAAC,KAAD,IAA1D,qBAGA,cAACD,EAAA,EAAD,CAAQE,SAAUrL,EAAQxC,OAAS,EAAGd,QArFpC,WAClB,IAAI4O,EAA0B,GAC9B,IACuB,WAAfzB,EACAyB,EAAW5E,GJKE,SAACgD,GAC1B,OAAOA,EACFvJ,KAAI,SAAAF,GACD,MAAO,CACHiI,OAAQjI,EAAOsK,SACfjK,KAAML,EAAOqK,SACb5G,MAAOzD,EAAO0K,KACdlC,OAAQxI,EAAOwK,SACf1D,KAAM9G,EAAOwK,SAAW,EAAI,MAAQ,OACpCxB,eAAgBV,KAAKgD,IAAItL,EAAOyK,sBIdKc,CAAqB9B,IACpC,YAAfG,IACPyB,EAAW5E,GJ8EG,SAACgD,GAC3B,OAAOA,EACF5C,QAAO,SAAApG,GAAC,MAA0B,WAAtBA,EAAE+K,iBAAsD,SAAtB/K,EAAE+K,mBAChDtL,KAAI,SAAAF,GACD,MAAO,CACHiI,OAAQjI,EAAO2B,WACftB,KAAML,EAAOwB,YACbiC,MAAOzD,EAAOsC,OACdkG,OAAQxI,EAAOkC,MACf4E,KAAiC,SAA3B9G,EAAOwL,gBAA6B,MAAQ,OAClDxC,eAAgBhJ,EAAOoC,kBIxFcqJ,CAAsBhC,KAE/DzP,QAAQC,IAAI,OAAQoR,GACpB1B,EAAWjJ,IAAEE,OAAOyK,GAAU,SAAC1I,GAAD,OAAOA,EAAEgG,YAAUzI,KAAI,SAAAO,GAAC,kCAC/CA,GAD+C,IAElDiI,QAASjI,EAAEiI,QAAQgD,cAAcC,UAAU,EAAG,IAC9ChD,SAAUlI,EAAEkI,SAAS+C,cAAcC,UAAU,EAAG,IAChDhE,YAAY,GAAD,OAAKvG,OAAOX,EAAEkH,aAAahE,QAAQ,GAAnC,QACXkF,aAAa,GAAD,OAAKpI,EAAEoI,aAAalF,QAAQ,GAA5B,cAEhBwG,GAAazJ,IAAE6G,MAAM8D,GAAU,SAAC1I,GAAD,OAAOA,EAAEkG,iBAC1C,MAAO5J,GACLgL,GAAahL,EAAE9E,WAmE2DC,QAAQ,YAAYwR,QAAS,cAAC,KAAD,IAA3F,sBAIFrC,GAAgC,IAAnBxJ,EAAQxC,QAAiB,cAAC,GAAD,CAAaiH,KAAK,WAAWD,KAAMA,IAC1EgF,GAAaxJ,EAAQxC,OAAS,GAC3B,gCACI,cAAC,GAAD,CAAaiH,KAAK,SAASD,KAAMxE,IACjC,+CAAkBmK,GAAUvG,QAAQ,GAApC,gBAGZ,cAAC,EAAD,W,SCjIV7F,GAAU,CAAC0E,EAAkBQ,GAO7B6I,GAAS,WACX,MAAoCpH,mBAAS,KAA7C,mBAAOxL,EAAP,KAAmBmQ,EAAnB,KACA,EAA0B3E,mBAAuB,IAAjD,mBAAO4E,EAAP,KAAcC,EAAd,KACA,EAAkC7E,oBAAS,GAA3C,mBAAO8E,EAAP,KAAkBC,EAAlB,KACA,EAAwB/E,mBAA6B,IAArD,mBAAOF,EAAP,KAAauF,EAAb,KACA,EAA8BrF,mBAAmB,IAAjD,mBAAOgF,EAAP,KAAgBC,EAAhB,KACA,EAA8BjF,mBAAkC,IAAhE,mBAAO1E,EAAP,KAAgB4J,EAAhB,KACA,EAAoClF,mBAAS,IAA7C,mBAAOsF,EAAP,KAAmB+B,EAAnB,KACA,EAAkCrH,mBAAS,IAA3C,mBAAOuF,EAAP,KAAkBC,EAAlB,KAEA,EAAkCxF,mBAAS,GAA3C,oBAAOyF,GAAP,MAAkBC,GAAlB,MAGMzO,GAAQC,YAAY,CACtBC,WAAY,CACRlC,SAAU,MAyFlB,OAlDAoL,qBAAU,WACN,sBAAC,4CAAA/G,EAAA,2DACOsL,EAAM9L,OAAS,GADtB,gCAE0BK,EAAgByL,EAAOvL,IAFjD,OAEaI,EAFb,OAI0B,WADb0L,EAHb,UAG0B1L,EAAK,UAH/B,aAG0B,EAASY,SAElBiN,EAAM7N,EAAK,GAAL,MAAiB/D,QAEzB2R,EADQ,2BAARC,EACc,yDAEA7N,EAAK,GAAL,MAAiB/D,UAGb,aAAfyP,GACDoC,EAAuC9N,EL2IzCgC,KAAI,SAAAF,GAAW,IAAD,EACxBN,EAAK,UAAMM,EAAOiM,SACpB7K,OAAOpB,EAAOiM,UAAUtI,QAAQ,IAC/B3D,EAAOkM,mBAAqBlM,EAAOmM,wBAAwBxI,QAAQ,GAF7D,YAGH3D,EAAOoM,mBACf,MAAO,CACH7K,QAAS,IAAIlG,KAAK2E,EAAOqM,WAAW/I,eAAe,QAAS,CAAEC,SAAU,QACxE7B,MAAO1B,EAAOsM,MACdxK,KAAMpC,EACNuC,MAAOjC,EAAOkM,mBACd/J,MAAM,GAAD,OAAKf,OAAM,UAACpB,EAAOuM,YAAR,QAAgB,GAAG5I,QAAQ,GAAtC,YAA4C3D,EAAOoM,mBACxD/J,OAAO,GAAD,OAAKrC,EAAOmM,uBAAZ,YAAsCnM,EAAOoM,mBACnD7J,cAAc,GAAD,OAAKnB,OAAOpB,EAAOwM,MAAQxM,EAAOwM,MAAQ,GAAG7I,QAAQ,GAArD,YAA2D3D,EAAOoM,mBAC/EvI,UAAW7D,EAAOyM,oBKvJJC,EAF4B,eAEbjD,GACrBC,EAAW,2BACJD,GADG,IAEN,SAAW,GAAX,mBAAwB,OAAPiD,QAAO,IAAPA,KAASC,SAAWD,EAAQC,SAAW,IAAxD,YAAgEzO,OAEpE4L,EAAQpJ,IAAEE,OAAF,sBAAa2D,GAAb,YAAsByH,KAAkB,SAACrJ,GAAD,OAAOA,EAAEpB,YACzD6H,EAAc,KACdI,GAAa,IACS,gBAAfI,KACDgD,EAAgB1O,EAAKc,MAAK,SAACyB,GAAD,MAAyB,+BAAZ,OAADA,QAAC,IAADA,OAAA,EAAAA,EAAG1B,YAE3C+M,EAAc,GAAD,OAAIc,EAAc7N,MAAlB,oCAAmD6N,EAC3DvJ,UAAUC,eAAe,QAAS,CAAEC,SAAU,QADtC,MAGXsJ,EAAqBzJ,EAAwBlF,GAC7CwO,EAP+B,eAOhBjD,GACrBC,EAAW,2BACJD,GADG,IAEN,YAAc,GAAd,mBAA2B,OAAPiD,QAAO,IAAPA,KAASI,YAAcJ,EAAQI,YAAc,IAAjE,YAAyE5O,OAE7E4L,EAAQpJ,IAAEE,OAAF,sBAAa2D,GAAb,YAAsBsI,KAAqB,SAAClK,GAAD,OAAOA,EAAEpB,YAC5D6H,EAAc,KACdI,GAAa,IAEjBF,EAAS,IAtChB,0CAAD,KA0CD,CAACD,IAEJvE,qBAAU,WACN9K,QAAQC,IAAI,2BAA4BwP,KACzC,CAACA,IAIA,eAAC5N,EAAA,EAAD,CAAeH,MAAOA,GAAtB,UACI,cAACI,EAAA,EAAD,CAAcC,OAAQ,CAAEC,GAAI,CAAEC,OAAQ,EAAGC,QAAS,EAAGC,UAAW,WAChE,cAACC,EAAA,EAAD,IACA,eAACjD,EAAA,EAAD,CAAW+B,UAAU,OAAO9B,GAAI,CAAEC,GAAI,EAAGC,GAAI,GAA7C,UACI,eAACoB,EAAA,EAAD,CACIC,UAAU,SACVC,eAAe,SACfC,WAAW,SACXC,QAAS,EACTvB,MAAM,KALV,UAQI,cAACwB,EAAA,EAAD,CACIG,UAAU,KACVd,QAAQ,KACRa,MAAM,SACNzB,MAAM,eACN8C,cAAY,EACZlD,GAAI,CAAEmD,WAAY,OAAQlD,GAAI,GANlC,wBAUA,cAAC0B,EAAA,EAAD,CAAYC,UAAU,SAASC,MAAM,SAASb,QAAQ,KAAKhB,GAAI,CAAEC,GAAI,GAAK6B,UAAU,IAApF,+BAGC6O,GAAc,cAACe,EAAA,EAAD,CAAOC,SAAS,QAAhB,SAAyBhB,IACxC,cAAC,EAAD,CAAU9Q,WAAYA,EAAYC,YAvH7B,SAAC8R,GAAD,OAAwB1B,EAAS,GAAD,mBAAKD,GAAL,YAAe2B,QAwHpD,cAACjQ,EAAA,EAAD,CAAYC,UAAU,aAAa5B,GAAI,CAAE6R,GAAI,GAAK/P,UAAU,IAA5D,uDAGC8O,GAAa,cAACc,EAAA,EAAD,CAAOC,SAAS,QAAhB,SAAyBf,IACtCT,GAAa,eAAC7O,EAAA,EAAD,CAAOC,UAAU,MAAMG,QAAS,EAAhC,UACV,cAACoQ,EAAA,EAAD,CAAQ9Q,QAAQ,WAAWqC,QArH7B,WACd6M,EAAS,IACTQ,EAAQ,IACRJ,EAAW,IACXF,GAAa,GACbJ,EAAc,MAgHiD+B,UAAW,cAAC,KAAD,IAA1D,qBAGA,cAACD,EAAA,EAAD,CAAQE,SAAUrL,EAAQxC,OAAS,EAAGd,QAhHpC,WAClB,IAAM4O,EAAwB,GAC9B,IACI,OAAI5B,QAAJ,IAAIA,KAASkD,WACTtB,EAAS7N,KAAT,MAAA6N,EAAQ,YLyHO,SAAC5B,GAC5B,IAAMsD,EAAoC,GA+C1C,OA9CAtD,EAAQtB,SAAQ,SAAA6E,GACZ,GAAkC,YAA9BA,EAAUP,gBAA+B,CACzC,IAAMQ,EAAOD,EAAUE,MAAM9O,MAAM,KAG7B+O,EAAc/L,OAAO6L,EAAK,IAC1BG,EAAiBH,EAAK,GAC5BF,EAAevP,KAAf,2BACOwP,GADP,IAEIP,gBAAiB,OACjBF,KAAM,EACNC,MAAOQ,EAAUR,MAAQQ,EAAUT,QAEvCQ,EAAevP,KAAf,2BACOwP,GADP,IAEIP,gBAAiB,MACjBH,MAAOc,EACPlB,mBAAoBiB,EACpBhB,uBAAwBa,EAAUf,SAAWkB,UAEZ,kBAA9BH,EAAUP,iBAKoB,YAA9BO,EAAUP,kBAJjBM,EAAevP,KAAf,2BACOwP,GADP,IAEIP,gBAAiB,YAWChD,EAAQ4D,OAAON,GACxClG,QAAO,SAAApG,GAAC,MAA0B,QAAtBA,EAAEgM,iBAAmD,SAAtBhM,EAAEgM,mBAC7CvM,KAAI,SAAAF,GAAW,IAAD,EACX,MAAO,CACHiI,OAAQjI,EAAOsM,MACfjM,KAAM,IAAIhF,KAAK2E,EAAOqM,WACtB5I,MAAOrC,OAAOpB,EAAOmM,wBACrB3D,OAAQpH,OAAOpB,EAAOkM,oBACtBpF,KAAM9G,EAAOyM,gBACbzD,eAAgB5H,OAAM,UAACpB,EAAOuM,YAAR,QAAgB,OKtKrBe,CAAuB7D,EAAQkD,YAChD3S,QAAQC,IAAI,WAEhB,OAAIwP,QAAJ,IAAIA,KAASqD,cACT9S,QAAQC,IAAI,UACZoR,EAAS7N,KAAT,MAAA6N,EAAQ,YL8OU,SAAC5B,GAC/B,OAAOA,EACF5C,QAAO,SAAApG,GAAC,MAAe,QAAXA,EAAEqD,MAA6B,SAAXrD,EAAEqD,QAClC5D,KAAI,SAAAF,GACD,MAAO,CACHiI,OAAQjI,EAAOiD,QACf5C,KAAM,IAAIhF,KAAK2E,EAAOqD,WACtBI,MAAOrC,OAAOpB,EAAOyD,OACrB+E,OAAQpH,OAAOpB,EAAOwD,MACtBsD,KAAM9G,EAAO8D,KACbkF,eAAgB5H,OAAOpB,EAAO0D,SKxPb6J,CAA0B9D,EAAQqD,gBAEvD9S,QAAQC,IAAIoR,EAASxE,QAAO,SAAApG,GAAC,MAAiB,SAAbA,EAAEwH,WACnC,IAAMuF,EAAY/G,GAA0B4E,GAC5C1B,EAAWjJ,IAAEE,OAAO4M,GAAW,SAAC7K,GAAD,OAAOA,EAAEgG,YAAUzI,KAAI,SAAAO,GAAC,kCAChDA,GADgD,IAEnDiI,QAAS,IAAIrN,KAAKoF,EAAEiI,SAASgD,cAAcC,UAAU,EAAG,IACxDhD,SAAU,IAAItN,KAAKoF,EAAEkI,UAAU+C,cAAcC,UAAU,EAAG,IAC1DhE,YAAY,GAAD,OAAKvG,OAAOX,EAAEkH,aAAahE,QAAQ,GAAnC,QACXkF,aAAa,GAAD,OAAKpI,EAAEoI,aAAalF,QAAQ,GAA5B,cAEhBwG,GAAazJ,IAAE6G,MAAMiG,GAAW,SAAC7K,GAAD,OAAOA,EAAEkG,iBAC3C,MAAO5J,GACLgL,EAAahL,EAAE9E,WA0F2DC,QAAQ,YAAYwR,QAAS,cAAC,KAAD,IAA3F,sBAIFrC,GAAgC,IAAnBxJ,EAAQxC,QAAiB,cAAC,GAAD,CAAaiH,KAAK,SAASD,KAAMA,IACxExE,EAAQxC,OAAS,GACd,gCACI,cAAC,GAAD,CAAaiH,KAAK,SAASD,KAAMxE,IACjC,+CAAkBmK,GAAUvG,QAAQ,GAApC,gBAGZ,cAAC,EAAD,WC1KhB8J,IAASC,OACP,cAAC,KAAD,CAAeC,SAAUC,GAAzB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOC,KAAK,IAAIC,QAAS,cAAC,EAAD,MACzB,cAAC,IAAD,CAAOD,KAAK,OAAOC,QAAS,cAAC,EAAD,CAAU5U,YAAa,kBAAMc,QAAQC,IAAI,wBAAehB,WAAY,QAChG,cAAC,IAAD,CAAO4U,KAAK,aAAaC,QAAS,cAAC,GAAD,MAClC,cAAC,IAAD,CAAOD,KAAK,SAASC,QAAS,cAAC,GAAD,WAGlCC,SAASC,eAAe,W","file":"static/js/main.8c97cf6e.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport Container from '@mui/material/Container';\r\nimport { DropzoneAreaBase, FileObject } from 'react-mui-dropzone';\r\nimport UploadFileIcon from '@mui/icons-material/UploadFile';\r\nimport { createTheme, ThemeProvider } from '@mui/material';\r\n\r\n\r\ninterface Props {\r\n    zoneHeight: number,\r\n    handleFiles: (arg0: FileObject[]) => void;\r\n}\r\n\r\nconst Dropzone = ({ zoneHeight, handleFiles }: Props) => {\r\n    \r\n\r\n    const handleAlert = (message: any, variant: any) => {\r\n        console.log(`${variant}: ${message}`)\r\n    }\r\n    /***\r\n     * \r\n     * TODO REFACTOR ZONEHEIGHT INTO ENUM/BETTER LOGIC\r\n     */\r\n\r\n    return (\r\n        <Container sx={{\r\n            pt: 4, pb: 3,\r\n            width: \"100%\",\r\n            '& .MuiDropzoneArea-textContainer': {\r\n                color: 'black'\r\n            },\r\n            '& .MuiDropzoneArea-text': {\r\n                paddingTop: zoneHeight > 200 ? 8 : 4,\r\n                fontSize: 20,\r\n            },\r\n            '& .MuiDropzoneArea-root': {\r\n                height: zoneHeight,\r\n            },\r\n        }}>\r\n            <DropzoneAreaBase\r\n                acceptedFiles={['text/x-csv', 'text/plain', 'application/vnd.ms-excel']}\r\n                onAdd={handleFiles}\r\n                onDelete={(fileObj) => console.log('Removed File:', fileObj)}\r\n                onAlert={handleAlert}\r\n                Icon={UploadFileIcon as any}\r\n                dropzoneText={zoneHeight > 200 ? \"Pudota CSV-tiedostoja tähän\" : \"Pudota lisää CSV-tiedostoja tähän\"}\r\n                fileObjects={[]}\r\n            />\r\n        </Container>\r\n    );\r\n}\r\n\r\nexport { Dropzone }","import Link from '@mui/material/Link';\r\nimport Typography from '@mui/material/Typography';\r\nimport { Stack} from '@mui/material';\r\n\r\nconst Copyright = () => {\r\n    return (\r\n        <Stack\r\n            direction=\"column\"\r\n            justifyContent=\"center\"\r\n            alignItems=\"center\"\r\n            spacing={1}\r\n            width={\"sm\"}\r\n            sx={{ pt: 2 }}\r\n        >\r\n            <Typography alignSelf=\"center\" align=\"center\" component=\"p\" sx={{ pt: 4 }}>\r\n                Tarkista tiedot aina itse virheiden varalta.\r\n            </Typography>\r\n            <Typography alignSelf=\"center\" align=\"center\" component=\"p\" sx={{ pt: 0 }}>\r\n                Oleta, että tämän sivuston tekijät eivät tiedä mitään veroista.\r\n            </Typography>\r\n            <Typography alignSelf=\"center\" align=\"center\" component=\"p\" sx={{ pt: 0 }}>\r\n                Sivustolle lähettämiäsi tiedostoja käsitellään vain paikallisesti selaimessasi.\r\n            </Typography>\r\n            <Typography variant=\"body2\" sx={{ pt: 2 }} color=\"text.secondary\" align=\"center\" >\r\n                {'Copyright © '}\r\n                <Link color=\"inherit\" href=\"https://verotunkki.fi/\">\r\n                    Verotunkki\r\n                </Link>{' '}\r\n                {new Date().getFullYear()}\r\n                {'.'}\r\n            </Typography>\r\n        </Stack>\r\n    );\r\n}\r\n\r\nexport { Copyright }\r\n","import { Fragment } from 'react'\r\n\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport Grid from '@mui/material/Grid';\r\nimport Link from '@mui/material/Link';\r\nimport GlobalStyles from '@mui/material/GlobalStyles';\r\nimport Container from '@mui/material/Container';\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Card from '@mui/material/Card';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport CardMedia from '@mui/material/CardMedia';\r\nimport { Copyright } from './Copyright'\r\nimport Typography from '@mui/material/Typography';\r\nimport { CardActionArea, createTheme, Paper, Stack, styled, ThemeProvider } from '@mui/material';\r\n\r\nconst FrontPageContent = () => {\r\n    const navigate = useNavigate();\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        },\r\n    });\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <GlobalStyles styles={{ ul: { margin: 0, padding: 0, listStyle: 'none' } }} />\r\n            <CssBaseline />\r\n            <Container component=\"main\" maxWidth=\"sm\" sx={{ pt: 8, pb: 4 }}>\r\n                <Stack\r\n                    direction=\"column\"\r\n                    justifyContent=\"center\"\r\n                    alignItems=\"center\"\r\n                    spacing={6}\r\n                    width=\"sm\"\r\n\r\n                >\r\n                    <Typography\r\n                        component=\"h1\"\r\n                        variant=\"h3\"\r\n                        align=\"center\"\r\n                        color=\"text.primary\"\r\n                        gutterBottom\r\n                        sx={{ fontWeight: 'bold', pt: 8 }}\r\n                    >\r\n                        VEROTUNKKI\r\n                    </Typography>\r\n                    <Typography alignSelf=\"center\" align=\"center\" variant=\"h6\" sx={{ pt: 3 }} component=\"p\">\r\n                        Verotunkki laskee puolestasi luovutusvoitot ja -tappiot, ja ulostaa verottajayhteensopivan\r\n                        rapsan. Hyvä elämä vittu\r\n                    </Typography>\r\n                    <Typography alignSelf=\"center\" variant=\"h6\" component=\"p\" sx={{ pt: 2 }}>\r\n                        Valitse verotettavan tulon tyyppi:\r\n                    </Typography>\r\n                    <Card sx={{ width: 450 }} onClick={() => {\r\n                        navigate(\"/crypto\");\r\n                    }}>\r\n                        <CardActionArea>\r\n                            <CardContent>\r\n                                <Typography gutterBottom variant=\"h5\" component=\"div\">\r\n                                    Virtuaalivaluutat\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                    Perus hyvä Ethereum.\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                    Tuetut lähteet: <b>Coinbase, Coinbase Pro</b>\r\n                                </Typography>\r\n                            </CardContent>\r\n                        </CardActionArea>\r\n                    </Card>\r\n                    <Card sx={{ width: 450 }} onClick={() => {\r\n                        navigate(\"/securities\");\r\n                    }}>\r\n                        <CardActionArea>\r\n                            <CardContent>\r\n                                <Typography gutterBottom variant=\"h5\" component=\"div\">\r\n                                    Arvopaperit\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                    Osakkeet ETF:t, rahastot ja muut arvopaperit.\r\n                                </Typography>\r\n                                <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                    Tuetut lähteet: <b>Degiro, Nordnet</b>\r\n                                </Typography>\r\n                            </CardContent>\r\n                        </CardActionArea>\r\n                    </Card>\r\n                </Stack>\r\n                <Copyright />\r\n            </Container>\r\n        </ThemeProvider>\r\n    );\r\n}\r\n\r\nexport { FrontPageContent as Frontpage }\r\n","const degiroFiToEn = {\n    \"Päiväys\": \"date\",\n    \"Aika\": \"time\",\n    \"Tuote\": \"security\",\n    \"ISIN\": \"ISIN\",\n    \"Reference\": \"reference\",\n    \"Venue\": \"venue\",\n    \"Quantity\": \"quantity\",\n    \"Kurssi\": \"rate\",\n    \"Kurssi-valuutta\": \"rateCurrency\",\n    \"Markkina-arvo\": \"marketValue\",\n    \"Markkina-arvo-valuutta\": \"marketValueCurrency\",\n    \"Value\": \"value\",\n    \"Value-valuutta\": \"valueCurrency\",\n    \"Vaihtokurssi\": \"exchangeRate\",\n    \"Transaction costs\": \"transactionCosts\",\n    \"Transaction costs-valuutta\": \"transactionCostsCurrency\",\n    \"Kokonaissumma\": \"totalAmount\",\n    \"Kokonaissumma-valuutta\": \"totalAmountCurrency\",\n    \"Order ID\": \"orderId\"\n}\n\nconst translateDegiro = (key: keyof typeof degiroFiToEn) => {\n    if (degiroFiToEn[key]) {\n        return degiroFiToEn[key]\n    }\n}\n\nexport default translateDegiro;","export interface DegiroHeaders {\n  time: string;\n  security: string;\n  ISIN: string;\n  reference: string;\n  venue: string;\n  quantity: number;\n  rate: number;\n  rateCurrency: string;\n  marketValue: number;\n  marketValueCurrency: string;\n  value: number;\n  valueCurrency: string;\n  exchangeRate: number;\n  transactionCosts: number;\n  transactionCostsCurrency: string;\n  totalAmount: number;\n  totalAmountCurrency: string;\n  orderId: string;\n  datetime: Date;\n  Source: \"Degiro\";\n  Error?: string;\n}\n\nexport interface CoinbaseHeaders {\n  Timestamp: Date;\n  TransactionType: \"BUY\" | \"SELL\" | \"RECEIVE\" | \"CONVERT\" | \"COINBASE EARN\";\n  Asset: string;\n  QuantityTransacted: number;\n  SpotPriceCurrency: string;\n  SpotPriceatTransaction: number;\n  Subtotal: number;\n  Total: number;\n  Fees: number;\n  Notes: string;\n  Source: \"Coinbase\";\n  Error?: string;\n}\n\nexport interface NordnetHeaders {\n  Id: string;\n  Kirjauspaiva: Date;\n  Kauppapaiva: Date;\n  Maksupaiva: string;\n  Salkku: string;\n  Tapahtumatyyppi: string;\n  Arvopaperi: string;\n  Instrumenttityyppi: string;\n  ISIN: string;\n  Maara: number;\n  Kurssi: number;\n  Korko: string;\n  Kokonaiskulut: number;\n  KokonaiskulutValuutta: string;\n  Summa: number;\n  Valuutta: string;\n  Hankintaarvo: string;\n  Tulos: string;\n  Kokonaismaara: number;\n  Saldo: string;\n  Vaihtokurssi: string;\n  Tapahtumateksti: string;\n  Mitatointipaiva: string;\n  Laskelma: string;\n  Vahvistusnumero: string;\n  Valityspalkkio: number;\n  ValityspalkkioValuutta: string;\n  Source: \"Nordnet\";\n  Error?: string;\n}\n\nexport interface CoinbaseProHeaders {\n  portfolio: string;\n  tradeid: string;\n  product: string;\n  side: string;\n  createdat: Date;\n  size: number;\n  sizeunit: string;\n  price: number;\n  fee: number;\n  total: number;\n  pricefeetotalunit: string;\n  Source: \"CoinbasePro\"\n  Error?: string;\n}\n\nexport const CoinBaseProHeaderValues = [\n  \"portfolio\",\n  \"tradeid\",\n  \"product\",\n  \"side\",\n  \"createdat\",\n  \"size\",\n  \"sizeunit\",\n  \"price\",\n  \"fee\",\n  \"total\",\n  \"pricefeetotalunit\"\n]\n\nexport const CoinBaseHeaderValues = [\n  'Timestamp',\n  'TransactionType',\n  'Asset',\n  'QuantityTransacted',\n  'SpotPriceCurrency',\n  'SpotPriceatTransaction',\n  'Subtotal',\n  'Total',\n  'Fees',\n  'Notes',\n]\n\nexport const DegiroHeaderValues = [\n  'date',\n  'time',\n  'security',\n  'ISIN',\n  'reference',\n  'venue',\n  'quantity',\n  'rate',\n  'rateCurrency',\n  'marketValue',\n  'marketValueCurrency',\n  'value',\n  'valueCurrency',\n  'exchangeRate',\n  'transactionCosts',\n  'transactionCostsCurrency',\n  'totalAmount',\n  'totalAmountCurrency',\n  'orderId',\n  'datetime'\n]\n\nexport const NordnetHeaderValues = [\n  'Id', 'Kirjauspaiva',\n  'Kauppapaiva', 'Maksupaiva',\n  'Salkku', 'Tapahtumatyyppi',\n  'Arvopaperi', 'Instrumenttityyppi',\n  'ISIN', 'Maara',\n  'Kurssi', 'Korko',\n  'Kokonaiskulut', 'KokonaiskulutValuutta',\n  'Summa', 'Valuutta',\n  'Hankintaarvo', 'Tulos',\n  'Kokonaismaara', 'Saldo',\n  'Vaihtokurssi', 'Tapahtumateksti',\n  'Mitatointipaiva', 'Laskelma',\n  'Vahvistusnumero', 'Valityspalkkio',\n  'ValityspalkkioValuutta'\n]\n","import { FileObject } from \"react-mui-dropzone\";\r\n\r\n/**\r\n * Workaround for browsers.\r\n * https://developer.mozilla.org/en-US/docs/Glossary/Base64#solution_1_%E2%80%93_escaping_the_string_before_encoding_it\r\n */\r\nconst b64_to_utf8 = (str: string) => (decodeURIComponent(escape(window.atob(str))))\r\n\r\nconst decodeUTF16LE = (binaryStr: string) => {\r\n    const cp = [];\r\n    for (let i = 0; i < binaryStr.length; i += 2)\r\n        cp.push(binaryStr.charCodeAt(i) | (binaryStr.charCodeAt(i + 1) << 8));\r\n    return String.fromCharCode(...cp);\r\n}\r\n\r\n/**\r\n * Gets the current file and checks it againts parsers.\r\n * @param filesCopy \r\n * @returns headers\r\n */\r\nconst chooseCSVParser = async (filesCopy: FileObject[], parsers: any[]) => {\r\n    const errors: Error[] = []\r\n    for (let i = 0; i < parsers.length; i++) {\r\n        try {\r\n            const inputFile = filesCopy[0].data ? filesCopy[0].data.toString().split(',')[1] : \"\"\r\n            const fileContentBuffer = parsers[i].name === 'parseNordNetCSV' ? decodeUTF16LE(atob(inputFile)) : b64_to_utf8(inputFile)\r\n            const fileContent = fileContentBuffer.toString()\r\n            const parsedData = await parsers[i](fileContent)\r\n            return parsedData\r\n        } catch (e: any) {\r\n            errors.push(e)\r\n        }\r\n    }\r\n    return [{ Source: \"Error\", Error: (errors.find(e => (e instanceof TypeError)) ?? errors[0]) }]\r\n}\r\n\r\n/**\r\n * Due to Jest (26.x.x) being the latest stable release, we have to default to commonjs module for tests.\r\n * The ESM module support through Babel was not sufficient and resulted in different behaviour. \r\n * @returns parse function\r\n */\r\nconst loadParser: any = async () => (process.env.NODE_ENV === 'test' ?\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore  \r\n    (await import('csv/dist/cjs/sync.cjs')).parse :\r\n    (await import('csv/dist/esm/sync')).parse\r\n)\r\n\r\n\r\n\r\nexport { chooseCSVParser, loadParser }","import translateDegiro from './translations'\nimport moment from 'moment';\nimport 'moment-timezone';\nimport { Operation } from '../fifo/types'\nimport { DegiroHeaders, CoinbaseHeaders, CoinbaseProHeaders, CoinBaseProHeaderValues, CoinBaseHeaderValues, DegiroHeaderValues, NordnetHeaderValues, NordnetHeaders } from './types'\nimport { ColumnDataCrypto, ColumnDataSecurity } from '../../components/tableSettings'\nimport _ from 'lodash';\nimport { loadParser } from './helpers';\n\n\nconst parseDegiroCSV = async (input: string): Promise<DegiroHeaders[]> => {\n    let prevField = \"\"\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value === '') return translateDegiro(`${prevField}-valuutta` as any);\n                prevField = value\n                return translateDegiro(value)\n            }\n            return String(value)\n        },\n        columns: true,\n        trim: true,\n    });\n\n    const results = []\n    for await (const record of tmp) {\n        results.push(record)\n    }\n\n    const records: DegiroHeaders[] = results.map((transaction: any) => {\n        transaction['datetime'] = moment(`${transaction.date}-${transaction.time}`, \"DD-MM-YYYY-HH-mm\").toDate()\n        return transaction\n    })\n\n    if (results.every(x => _.difference(_.sortBy(DegiroHeaderValues), _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Degiro file.')\n    }\n\n    return records.map(x => ({\n        ...x, \"Source\": \"Degiro\"\n    }))\n\n}\n\nconst getDegiroAsColumns = (records: DegiroHeaders[]): ColumnDataSecurity[] => {\n    const ret = records.map(record => {\n        return {\n            paivays: record.datetime.toUTCString(),\n            tuote: record.security,\n            isin: record.ISIN,\n            arvo: `${record.value} ${record.valueCurrency}`,\n            maara: record.quantity,\n            kulut: record.transactionCosts,\n            kurssi: `${record.rate} ${record.rateCurrency}`,\n            kokonaissumma: `${record.totalAmount} ${record.totalAmountCurrency}`,\n        } as ColumnDataSecurity\n    })\n    return ret\n}\n\nconst prepareDegiroForFIFO = (rawData: DegiroHeaders[]): Operation[] => {\n    return rawData\n        .map(record => {\n            return {\n                symbol: record.security,\n                date: record.datetime,\n                price: record.rate,\n                amount: record.quantity,\n                type: record.quantity > 0 ? \"BUY\" : \"SELL\",\n                transactionFee: Math.max(record.transactionCosts),\n            }\n        })\n}\n\n\nconst parseNordNetCSV = async (input: string): Promise<NordnetHeaders[]> => {\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        delimiter: [\"\\t\"],\n        columns: true,\n        trim: true,\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                let header = value\n                if (header.includes('ä')) header = header.replace(/ä/g, 'a')\n                if (header.includes('ö')) header = header.replace(/ö/g, 'o')\n                if (header.includes('-')) header = header.replace(/-/g, '')\n                return header.replace(/\\s/g, '')\n            }\n            const column = context.column\n            //these are probably unneeded\n            if (column === 'Maara' ||\n                column === 'Kurssi' ||\n                column === 'Valityspalkkio' ||\n                column === 'Summa' ||\n                column === 'Kokonaiskulut' ||\n                column === 'Kokonaismaara') return Number.parseFloat(value.replace(/,/g, '.'));\n            if (column === 'Kirjauspaiva' ||\n                column === 'Kauppapaiva' ||\n                column === 'Maksupaiva') return moment(value, \"YYYY-MM-DD\").toDate()\n            return String(value)\n        },\n    })\n\n    const results = []\n    for await (const record of tmp) {\n        results.push(record)\n    }\n\n    if (results.every(x => _.difference(NordnetHeaderValues, _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Nordnet file.')\n    }\n\n    return results.map(x => ({\n        ...x, \"Source\": \"Nordnet\"\n    })) as NordnetHeaders[]\n}\n\nconst getNordnetAsColumns = (records: NordnetHeaders[]): ColumnDataSecurity[] => {\n    const ret = records.map(record => {\n        return {\n            paivays: record.Kauppapaiva.toUTCString(),\n            tuote: record.Arvopaperi,\n            isin: record.ISIN,\n            arvo: `${record.Summa} ${record.Valuutta}`,\n            maara: record.Maara,\n            kulut: record.Kokonaiskulut,\n            kurssi: `${record.Kurssi} ${record.Valuutta}`,\n            kokonaissumma: `${record.Summa - record.Kokonaiskulut} ${record.Valuutta}`,\n        } as ColumnDataSecurity\n    })\n    return ret\n}\n\n\nconst prepareNordnetForFIFO = (rawData: NordnetHeaders[]): Operation[] => {\n    return rawData\n        .filter(x => x.Tapahtumatyyppi === 'MYYNTI' || x.Tapahtumatyyppi === 'OSTO')\n        .map(record => {\n            return {\n                symbol: record.Arvopaperi,\n                date: record.Kauppapaiva,\n                price: record.Kurssi,\n                amount: record.Maara,\n                type: record.Tapahtumatyyppi === 'OSTO' ? \"BUY\" : \"SELL\",\n                transactionFee: record.Kokonaiskulut,\n            }\n        })\n}\n\n\nconst parseCoinbaseCSV = async (input: string): Promise<CoinbaseHeaders[]> => {\n    const startAt = _.findIndex(input?.split('\\n'), (o) => o?.startsWith('Timestamp,Transaction'))\n    const parse = await loadParser()\n    const results = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value.includes('(')) return value.split('(')[0].replace(/\\s/g, '')\n                return value.replace(/\\s/g, '')\n            }\n            moment.tz\n            if (context.column === 'Timestamp') return moment(value, \"YYYY-MM-DD-HH-mm\").tz('Europe/Helsinki').toDate()\n            if (context.column === 'TransactionType') return value.toUpperCase()\n            return String(value)\n        },\n        columns: true,\n        from_line: startAt > 0 ? startAt + 1 : 1,\n        trim: true,\n    })\n    if ((results ?? []).every((x: any) => _.difference(CoinBaseHeaderValues, _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Coinbase file.')\n    }\n\n    return results.map((x: any) => ({\n        ...x, \"Source\": \"Coinbase\"\n    })) as CoinbaseHeaders[];\n}\n\nconst prepareCoinbaseForFIFO = (rawData: CoinbaseHeaders[]): Operation[] => {\n    const prepareRawFifo: CoinbaseHeaders[] = []\n    rawData.forEach(statement => {\n        if (statement.TransactionType === 'CONVERT') {\n            const info = statement.Notes.split(' ')\n            //const soldAmount = info[1]\n            //const soldCurrency = info[2]\n            const boughAmount = Number(info[4])\n            const boughtCurrency = info[5]\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"SELL\",\n                Fees: 0,\n                Total: statement.Total - statement.Fees\n            })\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n                Asset: boughtCurrency,\n                QuantityTransacted: boughAmount,\n                SpotPriceatTransaction: statement.Subtotal / boughAmount\n            })\n        } else if (statement.TransactionType === 'COINBASE EARN') {\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n            })\n        } else if (statement.TransactionType === 'RECEIVE') {\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n            })\n        }\n\n    })\n\n    const dataFifo: Operation[] = rawData.concat(prepareRawFifo)\n        .filter(x => x.TransactionType === 'BUY' || x.TransactionType === 'SELL')\n        .map(record => {\n            return {\n                symbol: record.Asset,\n                date: new Date(record.Timestamp),\n                price: Number(record.SpotPriceatTransaction),\n                amount: Number(record.QuantityTransacted),\n                type: record.TransactionType as \"BUY\" | \"SELL\",\n                transactionFee: Number(record.Fees ?? 0),\n            }\n        })\n    return dataFifo\n\n}\n\n\nconst getCoinbaseAsColumns = (records: CoinbaseHeaders[]): ColumnDataCrypto[] => {\n    const ret = records.map(record => {\n        const value = `${record.Subtotal ?\n            Number(record.Subtotal).toFixed(2) :\n            (record.QuantityTransacted * record.SpotPriceatTransaction).toFixed(2)\n            } ${record.SpotPriceCurrency}`\n        return {\n            paivays: new Date(record.Timestamp).toLocaleString('en-GB', { timeZone: 'UTC' }),\n            tuote: record.Asset,\n            arvo: value,\n            maara: record.QuantityTransacted,\n            kulut: `${Number(record.Fees ?? 0).toFixed(2)} ${record.SpotPriceCurrency}`,\n            kurssi: `${record.SpotPriceatTransaction} ${record.SpotPriceCurrency}`,\n            kokonaissumma: `${Number(record.Total ? record.Total : 0).toFixed(2)} ${record.SpotPriceCurrency}`,\n            operaatio: record.TransactionType,\n        } as ColumnDataCrypto\n    })\n    return ret\n}\n\nconst parseCoinbaseProCSV = async (input: string): Promise<CoinbaseProHeaders[]> => {\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value.includes('/')) return value.replace(/\\//g, '').replace(/\\s/g, '')\n                return value.replace(/\\s/g, '')\n            }\n            if (context.column === 'createdat') return new Date(value)\n            return String(value)\n        },\n        columns: true,\n        trim: true,\n    })\n\n    const results = []\n    for await (const record of tmp) results.push(record)\n\n\n    if (results.every(x => _.difference(_.sortBy(CoinBaseProHeaderValues), _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Coinbase Pro file.')\n    }\n\n\n    return results.map((x: any) => ({\n        ...x, \n        Source: \"CoinbasePro\",\n        product: x.product.split('-')[0],\n        Error: (x.pricefeetotalunit !== \"EUR\" ? \"Invalid currency detected\" : undefined)\n    })) as CoinbaseProHeaders[]\n}\n\nconst getCoinbaseProAsColumns = (records: CoinbaseProHeaders[]): ColumnDataCrypto[] => {\n    const ret = records.map(record => {\n        return {\n            paivays: record.createdat.toLocaleString('en-GB', { timeZone: 'UTC' }),\n            tuote: record.product,\n            arvo: `${record.size * record.price} ${record.pricefeetotalunit}`,\n            maara: record.size,\n            kulut: `${Number(record.fee ?? 0).toFixed(2)} ${record.pricefeetotalunit}`,\n            kurssi: `${record.price} ${record.pricefeetotalunit}`,\n            kokonaissumma: `${Number(record.total ?? 0).toFixed(2)} ${record.pricefeetotalunit}`,\n            operaatio: record.side,\n        } as ColumnDataCrypto\n    })\n    return ret\n}\n\n\nconst prepareCoinbaseProForFIFO = (rawData: CoinbaseProHeaders[]): Operation[] => {\n    return rawData\n        .filter(x => x.side === 'BUY' || x.side === 'SELL')\n        .map(record => {\n            return {\n                symbol: record.product,\n                date: new Date(record.createdat),\n                price: Number(record.price),\n                amount: Number(record.size),\n                type: record.side as \"BUY\" | \"SELL\",\n                transactionFee: Number(record.fee),\n            }\n        })\n}\n\nexport {\n    parseCoinbaseCSV,\n    parseDegiroCSV,\n    parseNordNetCSV,\n    getDegiroAsColumns,\n    getCoinbaseAsColumns,\n    prepareCoinbaseForFIFO,\n    parseCoinbaseProCSV,\n    getCoinbaseProAsColumns,\n    prepareCoinbaseProForFIFO,\n    getNordnetAsColumns,\n    prepareNordnetForFIFO,\n    prepareDegiroForFIFO\n}\n","export interface ColumnSecurity {\r\n    id: 'paivays' | 'tuote' | 'isin' | 'maara' | 'arvo' | 'kulut' | 'kokonaissumma' | 'kurssi';\r\n    label: string;\r\n    minWidth?: number;\r\n    align?: 'right';\r\n    format?: (value: number) => string;\r\n}\r\n\r\nexport interface ColumnCrypto {\r\n    id: 'paivays' | 'tuote' | 'arvo' | 'maara' | 'arvo' | 'kulut' | 'kokonaissumma' | 'kurssi' | 'operaatio';\r\n    label: string;\r\n    minWidth?: number;\r\n    align?: 'right';\r\n    format?: (value: number) => string;\r\n}\r\n\r\nexport interface ColumnTransaction {\r\n    id: 'ticker' | 'buydate' | 'selldate' | 'amountsold' | 'transferPrice' | 'acquisitionPrice' | 'acquisitionFee' | 'transferFee' | 'profitOrLoss';\r\n    label: string;\r\n    minWidth?: number;\r\n    align?: 'right';\r\n    format?: (value: number) => string;\r\n}\r\n\r\n\r\nconst columnsTransaction: readonly ColumnTransaction[] = [\r\n    { id: 'ticker', label: 'Tuote', minWidth: 120 },\r\n    { id: 'buydate', label: 'Hankintapäivä', minWidth: 150 },\r\n    { id: 'selldate', label: 'Luovutuspäivä', minWidth: 150 },\r\n    {\r\n        id: 'amountsold', label: 'Myyty kpl', minWidth: 100,\r\n        format: (value: number) => value.toFixed(8)\r\n    },\r\n    { id: 'transferPrice', label: 'Luovutushinta', minWidth: 120 },\r\n    {\r\n        id: 'acquisitionPrice', label: 'Hankintahinta', minWidth: 100,\r\n        format: (value: number) => value.toFixed(2)\r\n    },\r\n    { id: 'acquisitionFee', label: 'Hankintakulut', minWidth: 100 },\r\n    { id: 'transferFee', label: 'Luovutuskulut', minWidth: 80 },\r\n    {\r\n        id: 'profitOrLoss', label: 'Voitto/Tappio', minWidth: 170,\r\n        format: (value: number) => value.toFixed(3)\r\n    },\r\n];\r\n\r\n\r\nconst columnsSecurity: readonly ColumnSecurity[] = [\r\n    { id: 'paivays', label: 'Paivays', minWidth: 150 },\r\n    { id: 'tuote', label: 'Tuote', minWidth: 200 },\r\n    { id: 'isin', label: 'ISIN', minWidth: 170 },\r\n    {\r\n        id: 'maara', label: 'Maara', minWidth: 100,\r\n        format: (value: number) => value.toFixed(2)\r\n    },\r\n    { id: 'kurssi', label: 'Kurssi', minWidth: 120 },\r\n    { id: 'arvo', label: 'Arvo', minWidth: 100 },\r\n    { id: 'kulut', label: 'Kulut', minWidth: 100 },\r\n    { id: 'kokonaissumma', label: 'Kokonaissumma', minWidth: 170 },\r\n];\r\n\r\nconst columnsCrypto: readonly ColumnCrypto[] = [\r\n    { id: 'paivays', label: 'Paivays', minWidth: 150 },\r\n    { id: 'operaatio', label: 'Operaatio', minWidth: 100 },\r\n    { id: 'tuote', label: 'Tuote', minWidth: 100 },\r\n    { id: 'arvo', label: 'Arvo', minWidth: 100 },\r\n    {\r\n        id: 'maara', label: 'Määrä', minWidth: 100,\r\n        format: (value: number) => value.toFixed(2)\r\n    },\r\n    { id: 'kurssi', label: 'Kurssi', minWidth: 120 },\r\n    {\r\n        id: 'kulut', label: 'Kulut', minWidth: 110,\r\n        format: (value: number) => value.toFixed(4)\r\n    },\r\n    { id: 'kokonaissumma', label: 'Kokonaissumma', minWidth: 170 },\r\n];\r\n\r\n\r\nexport interface ColumnDataSecurity {\r\n    paivays: string;\r\n    tuote: string;\r\n    isin: string;\r\n    arvo: string;\r\n    maara: number;\r\n    kulut: number;\r\n    kurssi: string;\r\n    kokonaissumma: string;\r\n}\r\n\r\n\r\nexport interface ColumnDataCrypto {\r\n    paivays: string;\r\n    operation: string;\r\n    tuote: string;\r\n    arvo: string;\r\n    maara: number;\r\n    kulut: string;\r\n    kurssi: string;\r\n    kokonaissumma: string;\r\n    operaatio: string;\r\n}\r\n\r\n\r\nexport interface ColumnDataTransaction {\r\n    ticker: string\r\n    buydate: string\r\n    selldate: string\r\n    amountsold: number\r\n    transferPrice: number\r\n    acquisitionPrice: number\r\n    acquisitionFee: number\r\n    transferFee: string\r\n    profitOrLoss: string\r\n}\r\n\r\n\r\n\r\nexport { columnsSecurity, columnsCrypto, columnsTransaction }\r\n","import { ChangeEvent, useEffect, useState } from 'react'\r\nimport { Paper, Stack, styled, Table, TableBody, TableCell, TableContainer, TableHead, TablePagination, TableRow } from '@mui/material';\r\nimport { ColumnCrypto, ColumnDataCrypto, ColumnDataSecurity, columnsCrypto, ColumnSecurity, columnsSecurity, columnsTransaction, ColumnTransaction, ColumnDataTransaction } from './tableSettings'\r\ninterface Props {\r\n    rows: ColumnDataSecurity[] | ColumnDataCrypto[] | ColumnDataTransaction[],\r\n    mode: \"Crypto\" | \"Security\" | 'Result',\r\n}\r\n\r\n\r\nconst ResultTable = ({ rows, mode }: Props) => {\r\n\r\n    // Table specific states\r\n    const [page, setPage] = useState(0);\r\n    const [rowsPerPage, setRowsPerPage] = useState(10);\r\n\r\n    let columns: readonly ColumnSecurity[] | readonly ColumnCrypto[] | readonly ColumnTransaction[] = []\r\n    if (mode === \"Security\") {\r\n        columns = columnsSecurity\r\n    } else if (mode === \"Crypto\") {\r\n        columns = columnsCrypto\r\n    } else if (mode === \"Result\") {\r\n        columns = columnsTransaction\r\n    }\r\n\r\n    const handleChangePage = (event: unknown, newPage: number) => {\r\n        setPage(newPage);\r\n    };\r\n    const handleChangeRowsPerPage = (event: ChangeEvent<HTMLInputElement>) => {\r\n        setRowsPerPage(+event.target.value);\r\n        setPage(0);\r\n    };\r\n\r\n    useEffect(() => {\r\n        window.scrollTo(0, 250)\r\n    }, [])\r\n\r\n    return (<><Paper sx={{ width: '100%', overflow: 'hidden' }}>\r\n        <TableContainer sx={{ maxHeight: 1400 }}>\r\n            <Table stickyHeader aria-label=\"sticky table\">\r\n                <TableHead>\r\n                    <TableRow>\r\n                        {columns.map((column) => (\r\n                            <TableCell\r\n                                key={column.id}\r\n                                align={column.align}\r\n                                style={{ minWidth: column.minWidth }}\r\n                            >\r\n                                {column.label}\r\n                            </TableCell>\r\n                        ))}\r\n                    </TableRow>\r\n                </TableHead>\r\n                <TableBody>\r\n                    {rows\r\n                        .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)\r\n                        .map((row, index) => {\r\n                            return (\r\n                                <TableRow hover role=\"checkbox\" tabIndex={-1} key={index}>\r\n                                    {columns.map((column) => {\r\n                                        const value = (row as any)[column.id]\r\n                                        return (\r\n                                            <TableCell key={column.id} align={column.align}>\r\n                                                {column.format && typeof value === 'number'\r\n                                                    ? column.format(value)\r\n                                                    : value}\r\n                                            </TableCell>\r\n                                        );\r\n                                    })}\r\n                                </TableRow>\r\n                            );\r\n                        })}\r\n                </TableBody>\r\n            </Table>\r\n        </TableContainer>\r\n        <TablePagination\r\n            rowsPerPageOptions={[10, 25, 100]}\r\n            component=\"div\"\r\n            count={rows.length}\r\n            rowsPerPage={rowsPerPage}\r\n            page={page}\r\n            onPageChange={handleChangePage}\r\n            onRowsPerPageChange={handleChangeRowsPerPage}\r\n        />\r\n    </Paper>\r\n    </>)\r\n}\r\n\r\nexport { ResultTable }\r\n","import { Operation, Transaction } from './types';\nimport _ from 'lodash';\n\nexport interface CapitalResults {\n  /**\n   * Sale that triggered the capital gains\n   */\n  transactions: Transaction[]\n\n  /**\n   * Capital gains triggered from the sale\n   */\n  capitalGainPerSellDate: number\n}\n\n/**\n * Calculates the FIFO capital gains for the given operation history.\n * It separates capital gains of securities using the symbols given\n * in each operation.\n *\n * @param operationHistory History of operations (buy and sales) to\n * calculate the capital gains for.\n *\n * @throws If the amount of securities of all sell operations of a given symbol\n * exceeds the amount of securities of all buy operations for the same symbol.\n * This indicates that there is an error in the input, since it is not possible\n * to sell more securities than the ones bought.\n *\n * @returns The FIFO capital gains with details of the transaction details\n * for each sell operation\n *\n * [\n    {\n        \"capitalGainPerSellDate\": -315.6,\n        \"transactions\": [\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2019-02-01T00:00:00.000Z\",\n                \"selldate\": \"2020-03-01T00:00:00.000Z\",\n                \"amountsold\": 3,\n                \"transferPrice\": 50,\n                \"profitOrLoss\": -300,\n                \"acquisitionPrice\": 150,\n                \"acquisitionFee\": 4.2,\n                \"transferFee\": 4.1\n            },\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2020-01-01T00:00:00.000Z\",\n                \"selldate\": \"2020-03-01T00:00:00.000Z\",\n                \"amountsold\": 1,\n                \"transferPrice\": 50,\n                \"profitOrLoss\": 0,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 3.2,\n                \"transferFee\": 4.1\n            }\n        ]\n    },\n    {\n        \"capitalGainPerSellDate\": 97.7,\n        \"transactions\": [\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2020-01-01T00:00:00.000Z\",\n                \"selldate\": \"2020-04-01T00:00:00.000Z\",\n                \"amountsold\": 3,\n                \"transferPrice\": 86,\n                \"profitOrLoss\": 108,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 3.2,\n                \"transferFee\": 7.1\n            }\n        ]\n    },\n    {\n        \"capitalGainPerSellDate\": 995.6999999999999,\n        \"transactions\": [\n            {\n                \"ticker\": \"BB\",\n                \"buydate\": \"2020-02-01T00:00:00.000Z\",\n                \"selldate\": \"2021-01-01T00:00:00.000Z\",\n                \"amountsold\": 10,\n                \"transferPrice\": 150,\n                \"profitOrLoss\": 1000,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 2.2,\n                \"transferFee\": 2.1\n            }\n        ]\n    }\n]\n */\nexport function calculateFIFOCapitalGains(\n  operationHistory: Operation[]\n): CapitalResults[] {\n  const history = operationHistory.map((obj) => ({ ...obj }));\n  const sales = history.filter(({ type }) => type === 'SELL');\n\n  return sales.reduce<CapitalResults[]>(\n    (capitalGainPerSellDate, sale) => [\n      ...capitalGainPerSellDate,\n      calculateCapitalGainsForSale(history, sale),\n    ],\n    []\n  );\n}\n\n/**\n * Calculates the FIFO capital gains for the given operation history. \n * Transfer fees are divided between SELL operations, so the end resulting\n * SELL batch trasnferprice for the bought asset remains the same.\n *\n * @param operationHistory History of operations (buy and sales) to\n * calculate the capital gains for. \n *\n * @returns The FIFO transaction details by every sold security\n * example\n *  {\n        ticker: 'GME',\n        buydate: 2020-01-01T00:00:00.000Z,\n        selldate: 2020-04-01T00:00:00.000Z,\n        amountsold: 3,\n        transferPrice: 86,\n        profitOrLoss: 108,\n        acquisitionPrice: 50,\n        acquisitionFee: 3.2,\n        transferFee: 7.1\n      },\n      {\n        ticker: 'BB',\n        buydate: 2020-02-01T00:00:00.000Z,\n        selldate: 2021-01-01T00:00:00.000Z,\n        amountsold: 10,\n        transferPrice: 150,\n        profitOrLoss: 1000,\n        acquisitionPrice: 50,\n        acquisitionFee: 2.2,\n        transferFee: 2.1\n      }\n *\n */\nexport const calculateFIFOTransactions = (operationHistory: Operation[]): Transaction[] => {\n  const a = calculateFIFOCapitalGains(operationHistory).flatMap((gainByDate) => {\n    const totalAmount = _.sumBy(gainByDate.transactions, (o) => o.amountsold)\n    const dividedFees = gainByDate.transactions.map(x => ({\n      ...x,\n      transferFee: (x.amountsold / totalAmount) * x.transferFee\n    }))\n    const transferFeeForSell = gainByDate.transactions[0] ? gainByDate.transactions[0].transferFee : 0\n    const transferFeeSummedFromSELLOperation = _.sumBy(dividedFees, (o) => o.transferFee)\n    if (transferFeeForSell !== transferFeeSummedFromSELLOperation) {\n      console.error(`Amount of fees for do not match for ${gainByDate.transactions[0]?.ticker}: ${transferFeeForSell} and ${transferFeeSummedFromSELLOperation}`)\n    }\n    return dividedFees\n  });\n  return a\n}\n\n\nconst calculateCapitalGainsForSale = (\n  operationHistory: Operation[],\n  sale: Operation\n): CapitalResults => {\n  let capitalGainPerSellDate = 0;\n  const transactions: Transaction[] = [];\n\n  const relatedBuyTransactions = operationHistory.filter(\n    ({ type, symbol, date }) =>\n      type === 'BUY' && symbol === sale.symbol && date < sale.date\n  );\n\n  // Order the result set in ASC order so the oldest buy operations are handled first\n  _.orderBy(relatedBuyTransactions, (o: Operation) => o.date, 'asc').forEach(\n    (buy) => {\n      const amountSold = Math.min(sale.amount, buy.amount);\n      // if the total amount of held shares have not yet been sold\n      if (amountSold === 0) return;\n      const trs: Transaction = {\n        ticker: sale.symbol,\n        buydate: buy.date,\n        selldate: sale.date,\n        amountsold: amountSold,\n        transferPrice: sale.price,\n        profitOrLoss: amountSold * (sale.price - buy.price),\n        acquisitionPrice: buy.price,\n        acquisitionFee: buy.transactionFee,\n        transferFee: sale.transactionFee,\n      };\n      transactions.push(trs);\n\n      buy.amount -= amountSold;\n      sale.amount -= amountSold;\n      // We reduce the transactionsfees from the capital gain\n      const totalPrice =\n        amountSold * (sale.price - buy.price)\n      capitalGainPerSellDate += totalPrice;\n    }\n  );\n  // TODO: removee nii perkeleesti ja implementoi uudestaan paremmin\n  //if (Number(sale.amount ?  sale.amount.toFixed(6) : 0) > 0) {\n  if (Math.round(sale.amount) > 0) {\n    throw Error(\n      `Amount of sales for ticker ${sale.symbol} exceeds the amount of buys by ${sale.amount}. In transaction made in ${new Date(sale.date)\n        .toLocaleString('en-GB', { timeZone: 'UTC' })}`\n    );\n  }\n\n  return {\n    capitalGainPerSellDate,\n    transactions: transactions,\n  };\n};\n","import { ChangeEvent, Fragment, useEffect, useState } from 'react'\r\n\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport GlobalStyles from '@mui/material/GlobalStyles';\r\nimport Container from '@mui/material/Container';\r\nimport Typography from '@mui/material/Typography';\r\nimport { Alert, Button, createTheme, Paper, Stack, styled, Table, TableBody, TableCell, TableContainer, TableHead, TablePagination, TableRow, ThemeProvider } from '@mui/material';\r\nimport { Dropzone } from './Dropzone';\r\nimport { FileObject } from 'react-mui-dropzone';\r\nimport { Copyright } from './Copyright';\r\nimport { parseDegiroCSV, getDegiroAsColumns, parseNordNetCSV, getNordnetAsColumns, prepareDegiroForFIFO, prepareNordnetForFIFO } from '../utils/parsers/loadTransactions'\r\nimport { CoinbaseHeaders, CoinbaseProHeaders, DegiroHeaders, NordnetHeaders } from '../utils/parsers/types';\r\nimport { ResultTable } from './ResultTable'\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport { ColumnDataSecurity, ColumnDataTransaction } from './tableSettings';\r\nimport { chooseCSVParser } from '../utils/parsers/helpers'\r\nimport _ from 'lodash';\r\nimport { calculateFIFOTransactions } from '../utils/fifo';\r\nimport { Transaction } from '../utils/fifo/types';\r\nconst parsers = [parseDegiroCSV, parseNordNetCSV]\r\n\r\nconst Securities = () => {\r\n    const [zoneHeight, setZoneHeight] = useState(400);\r\n    const [files, setFiles] = useState<FileObject[]>([]);\r\n    const [showTable, setShowTable] = useState(false)\r\n    const [rawData, setRawData] = useState<DegiroHeaders[] | NordnetHeaders[]>([]);\r\n    const [results, setResults] = useState<ColumnDataTransaction[]>([]);\r\n    const [dataSource, setDataSource] = useState<\"Degiro\" | \"Nordnet\">();\r\n    const [rows, setRows] = useState<ColumnDataSecurity[]>([]);\r\n    const [parseError, setParseError] = useState(\"\")\r\n    const [errorFifo, setErrorFifo] = useState(\"\")\r\n\r\n\r\n    const [tmpResult, setTmpResult] = useState(0);\r\n\r\n    const clearRows = () => {\r\n        setFiles([])\r\n        setRows([])\r\n        setRawData([])\r\n        setShowTable(false)\r\n        setZoneHeight(400)\r\n    }\r\n\r\n    const fileCallback = (file: FileObject[]) => setFiles(file)\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        },\r\n    });\r\n\r\n\r\n\r\n    const calculateFIFO = () => {\r\n        let fifoData: Transaction[] = []\r\n        try {\r\n            if (dataSource === 'Degiro') {\r\n                fifoData = calculateFIFOTransactions(prepareDegiroForFIFO(rawData as DegiroHeaders[]))\r\n            } else if (dataSource === 'Nordnet') {\r\n                fifoData = calculateFIFOTransactions(prepareNordnetForFIFO(rawData as NordnetHeaders[]))\r\n            }\r\n            console.log(\"maol\", fifoData)\r\n            setResults(_.sortBy(fifoData, (o) => o.selldate).map(x => ({\r\n                ...x,\r\n                buydate: x.buydate.toISOString().substring(0, 16),\r\n                selldate: x.selldate.toISOString().substring(0, 16),\r\n                transferFee: `${Number(x.transferFee).toFixed(4)} EUR`,\r\n                profitOrLoss: `${x.profitOrLoss.toFixed(3)} EUR`,\r\n            })))\r\n            setTmpResult(_.sumBy(fifoData, (o) => o.profitOrLoss))\r\n        } catch (e: any) {\r\n            setErrorFifo(e.message)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (files.length > 0) {\r\n                setZoneHeight(200)\r\n                setShowTable(true)\r\n                const data = await chooseCSVParser(files, parsers)\r\n                const dataSource = data[0]?.Source\r\n                if (dataSource === 'Degiro') {\r\n                    setDataSource('Degiro')\r\n                    const degiroColumns = getDegiroAsColumns(data as DegiroHeaders[])\r\n                    setRawData([...rawData, ...data] as DegiroHeaders[])\r\n                    setRows([...rows, ...degiroColumns])\r\n                    setZoneHeight(200)\r\n                    setShowTable(true)\r\n                } else if (dataSource === 'Nordnet') {\r\n                    setDataSource('Nordnet')\r\n                    const nordnetColumns = getNordnetAsColumns(data as NordnetHeaders[])\r\n                    setRawData([...rawData, ...data] as NordnetHeaders[])\r\n                    setRows([...rows, ...nordnetColumns])\r\n                    setZoneHeight(200)\r\n                    setShowTable(true)\r\n                }\r\n            }\r\n        })()\r\n    }, [files])\r\n\r\n\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <GlobalStyles styles={{ ul: { margin: 0, padding: 0, listStyle: 'none' } }} />\r\n            <CssBaseline />\r\n            <Container component=\"main\" sx={{ pt: 8, pb: 4 }}>\r\n                <Stack\r\n                    direction=\"column\"\r\n                    justifyContent=\"center\"\r\n                    alignItems=\"center\"\r\n                    spacing={3}\r\n                    width=\"sm\"\r\n\r\n                >\r\n                    <Typography\r\n                        component=\"h1\"\r\n                        variant=\"h3\"\r\n                        align=\"center\"\r\n                        color=\"text.primary\"\r\n                        gutterBottom\r\n                        sx={{ fontWeight: 'bold', pt: 8 }}\r\n                    >\r\n                        VEROTUNKKI\r\n                    </Typography>\r\n                    <Typography alignSelf=\"center\" align=\"center\" variant=\"h6\" sx={{ pt: 0 }} component=\"p\">\r\n                        Arvopaperit\r\n                    </Typography>\r\n                    {parseError && <Alert severity=\"error\">{parseError}</Alert>}\r\n                    <Dropzone zoneHeight={zoneHeight} handleFiles={fileCallback} />\r\n                    <Typography alignSelf=\"flex-start\" sx={{ pl: 4 }} component=\"p\">\r\n                        Tuetut lähteet: Nordnet, Degiro\r\n                    </Typography>\r\n                    {errorFifo && <Alert severity=\"error\">{errorFifo}</Alert>}\r\n                    {showTable && <Stack direction=\"row\" spacing={2}>\r\n                        <Button variant=\"outlined\" onClick={clearRows} startIcon={<DeleteIcon />}>\r\n                            Poistha\r\n                        </Button>\r\n                        <Button disabled={results.length > 0} onClick={calculateFIFO} variant=\"contained\" endIcon={<SendIcon />}>\r\n                            Laske\r\n                        </Button>\r\n                    </Stack>}\r\n                    {(showTable && results.length === 0) && <ResultTable mode=\"Security\" rows={rows} />}\r\n                    {showTable && results.length > 0 &&\r\n                        <div>\r\n                            <ResultTable mode=\"Result\" rows={results} />\r\n                            <p>Total naurut: {tmpResult.toFixed(2)} EUR</p>\r\n                        </div>}\r\n                </Stack>\r\n                <Copyright />\r\n            </Container>\r\n        </ThemeProvider>\r\n    );\r\n}\r\n\r\nexport { Securities }\r\n","import { ChangeEvent, Fragment, useEffect, useState } from 'react'\r\nimport _ from 'lodash';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport GlobalStyles from '@mui/material/GlobalStyles';\r\nimport Container from '@mui/material/Container';\r\nimport Typography from '@mui/material/Typography';\r\nimport { Alert, Button, createTheme, Paper, Stack, styled, Table, TableBody, TableCell, TableContainer, TableHead, TablePagination, TableRow, ThemeProvider } from '@mui/material';\r\nimport { Dropzone } from './Dropzone';\r\nimport { FileObject } from 'react-mui-dropzone';\r\nimport { Copyright } from './Copyright';\r\nimport { parseDegiroCSV, getDegiroAsColumns, parseCoinbaseProCSV, parseCoinbaseCSV, parseNordNetCSV, prepareCoinbaseForFIFO, getCoinbaseAsColumns, getCoinbaseProAsColumns, prepareCoinbaseProForFIFO } from '../utils/parsers/loadTransactions'\r\nimport { CoinbaseHeaders, CoinbaseProHeaders } from '../utils/parsers/types';\r\nimport { ResultTable } from './ResultTable'\r\nimport { ColumnDataCrypto, ColumnDataTransaction, columnsCrypto } from './tableSettings';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport { calculateFIFOTransactions } from '../utils/fifo'\r\nimport { Operation, Transaction } from '../utils/fifo/types'\r\nimport { chooseCSVParser } from '../utils/parsers/helpers'\r\n\r\nconst parsers = [parseCoinbaseCSV, parseCoinbaseProCSV]\r\n\r\nexport interface rawDatas {\r\n    Coinbase: CoinbaseHeaders[]\r\n    CoinbasePro: CoinbaseProHeaders[]\r\n}\r\n\r\nconst Crypto = () => {\r\n    const [zoneHeight, setZoneHeight] = useState(400);\r\n    const [files, setFiles] = useState<FileObject[]>([]);\r\n    const [showTable, setShowTable] = useState(false)\r\n    const [rows, setRows] = useState<ColumnDataCrypto[]>([]);\r\n    const [rawData, setRawData] = useState<rawDatas>({} as rawDatas);\r\n    const [results, setResults] = useState<ColumnDataTransaction[]>([]);\r\n    const [parseError, setParseError] = useState(\"\")\r\n    const [errorFifo, setErrorFifo] = useState(\"\")\r\n\r\n    const [tmpResult, setTmpResult] = useState(0);\r\n\r\n    const fileCallback = (file: FileObject[]) => setFiles([...files, ...file])\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        },\r\n    });\r\n\r\n\r\n    const clearRows = () => {\r\n        setFiles([])\r\n        setRows([])\r\n        setRawData({} as rawDatas)\r\n        setShowTable(false)\r\n        setZoneHeight(400)\r\n    }\r\n\r\n    const calculateFIFO = () => {\r\n        const fifoData: Operation[] = []\r\n        try {\r\n            if (rawData?.Coinbase) {\r\n                fifoData.push(...prepareCoinbaseForFIFO(rawData.Coinbase as CoinbaseHeaders[]))\r\n                console.log(\"added1\")\r\n            }\r\n            if (rawData?.CoinbasePro) {\r\n                console.log(\"added2\")\r\n                fifoData.push(...prepareCoinbaseProForFIFO(rawData.CoinbasePro as CoinbaseProHeaders[]))\r\n            }\r\n            console.log(fifoData.filter(x => x.symbol === 'LINK'))\r\n            const finalFifo = calculateFIFOTransactions(fifoData)\r\n            setResults(_.sortBy(finalFifo, (o) => o.selldate).map(x => ({\r\n                ...x,\r\n                buydate: new Date(x.buydate).toISOString().substring(0, 16),\r\n                selldate: new Date(x.selldate).toISOString().substring(0, 16),\r\n                transferFee: `${Number(x.transferFee).toFixed(4)} EUR`,\r\n                profitOrLoss: `${x.profitOrLoss.toFixed(3)} EUR`,\r\n            })))\r\n            setTmpResult(_.sumBy(finalFifo, (o) => o.profitOrLoss))\r\n        } catch (e: any) {\r\n            setErrorFifo(e.message)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (files.length > 0) {\r\n                const data = await chooseCSVParser(files, parsers)\r\n                const dataSource = data[0]?.Source\r\n                if (dataSource === 'Error') {\r\n                    const msg = data[0]['Error'].message\r\n                    if (msg === \"malformed URI sequence\") {\r\n                        setParseError(\"Unable to parse file, is it encoded in a weird format?\")\r\n                    } else {\r\n                        setParseError(data[0]['Error'].message)\r\n                    }\r\n\r\n                } else if (dataSource === 'Coinbase') {\r\n                    const coinBaseColumns = getCoinbaseAsColumns(data as CoinbaseHeaders[])\r\n                    const rawcopy = { ...rawData }\r\n                    setRawData({\r\n                        ...rawData,\r\n                        \"Coinbase\": [...(rawcopy?.Coinbase ? rawcopy.Coinbase : []), ...data]\r\n                    })\r\n                    setRows(_.sortBy([...rows, ...coinBaseColumns], (o) => o.paivays))\r\n                    setZoneHeight(200)\r\n                    setShowTable(true)\r\n                } else if (dataSource === 'CoinbasePro') {\r\n                    const currencyError = data.find((x: any) => x?.Error === \"Invalid currency detected\")\r\n                    if (currencyError)\r\n                        setParseError(`${currencyError.Error} In trancactions made in ${currencyError\r\n                            .createdat.toLocaleString('en-GB', { timeZone: 'UTC' })}.`)\r\n\r\n                    const coinBaseProColumns = getCoinbaseProAsColumns(data as CoinbaseProHeaders[])\r\n                    const rawcopy = { ...rawData }\r\n                    setRawData({\r\n                        ...rawData,\r\n                        \"CoinbasePro\": [...(rawcopy?.CoinbasePro ? rawcopy.CoinbasePro : []), ...data]\r\n                    })\r\n                    setRows(_.sortBy([...rows, ...coinBaseProColumns], (o) => o.paivays))\r\n                    setZoneHeight(200)\r\n                    setShowTable(true)\r\n                }\r\n                setFiles([])\r\n\r\n            }\r\n        })()\r\n    }, [files])\r\n\r\n    useEffect(() => {\r\n        console.log(\"rows parsed into rawdata\", rawData)\r\n    }, [rawData])\r\n\r\n\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <GlobalStyles styles={{ ul: { margin: 0, padding: 0, listStyle: 'none' } }} />\r\n            <CssBaseline />\r\n            <Container component=\"main\" sx={{ pt: 8, pb: 4 }}>\r\n                <Stack\r\n                    direction=\"column\"\r\n                    justifyContent=\"center\"\r\n                    alignItems=\"center\"\r\n                    spacing={3}\r\n                    width=\"sm\"\r\n\r\n                >\r\n                    <Typography\r\n                        component=\"h1\"\r\n                        variant=\"h3\"\r\n                        align=\"center\"\r\n                        color=\"text.primary\"\r\n                        gutterBottom\r\n                        sx={{ fontWeight: 'bold', pt: 8 }}\r\n                    >\r\n                        VEROTUNKKI\r\n                    </Typography>\r\n                    <Typography alignSelf=\"center\" align=\"center\" variant=\"h6\" sx={{ pt: 0 }} component=\"p\">\r\n                        Virtuaalivaluutat\r\n                    </Typography>\r\n                    {parseError && <Alert severity=\"error\">{parseError}</Alert>}\r\n                    <Dropzone zoneHeight={zoneHeight} handleFiles={fileCallback} />\r\n                    <Typography alignSelf=\"flex-start\" sx={{ pl: 4 }} component=\"p\">\r\n                        Tuetut lähteet: Coinbase, Coinbase Pro\r\n                    </Typography>\r\n                    {errorFifo && <Alert severity=\"error\">{errorFifo}</Alert>}\r\n                    {showTable && <Stack direction=\"row\" spacing={2}>\r\n                        <Button variant=\"outlined\" onClick={clearRows} startIcon={<DeleteIcon />}>\r\n                            Poistha\r\n                        </Button>\r\n                        <Button disabled={results.length > 0} onClick={calculateFIFO} variant=\"contained\" endIcon={<SendIcon />}>\r\n                            Laske\r\n                        </Button>\r\n                    </Stack>}\r\n                    {(showTable && results.length === 0) && <ResultTable mode=\"Crypto\" rows={rows} />}\r\n                    {results.length > 0 &&\r\n                        <div>\r\n                            <ResultTable mode=\"Result\" rows={results} />\r\n                            <p>Total naurut: {tmpResult.toFixed(2)} EUR</p>\r\n                        </div>}\r\n                </Stack>\r\n                <Copyright />\r\n            </Container>\r\n        </ThemeProvider>\r\n    );\r\n}\r\n\r\nexport { Crypto }","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Dropzone } from './components/Dropzone'\nimport { Frontpage } from './components/Frontpage'\nimport { Securities } from './components/Securities'\nimport { BrowserRouter, Route, Routes } from \"react-router-dom\";\nimport { Crypto } from './components/Crypto'\n\nReactDOM.render(\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Routes>\n      <Route path=\"/\" element={<Frontpage />} />\n      <Route path=\"maol\" element={<Dropzone handleFiles={() => console.log(\"hyvä elämä\")} zoneHeight={400} />} />\n      <Route path=\"securities\" element={<Securities />} />\n      <Route path=\"crypto\" element={<Crypto />} />\n    </Routes>\n  </BrowserRouter>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}