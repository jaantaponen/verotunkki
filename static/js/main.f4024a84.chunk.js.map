{"version":3,"sources":["components/Copyright.tsx","components/Frontpage.tsx","components/Dropzone.tsx","utils/parsers/translations.ts","utils/parsers/types.ts","utils/parsers/helpers.ts","utils/parsers/loadTransactions.ts","components/tableSettings.tsx","components/ResultTable.tsx","components/ResultCard.tsx","utils/fifo/fifo.ts","components/PreviewTable.tsx","components/PreviewData.tsx","index.tsx"],"names":["Copyright","Stack","direction","justifyContent","alignItems","spacing","width","sx","pt","pb","Typography","variant","color","align","Link","href","Date","getFullYear","FrontPageContent","navigate","useNavigate","theme","createTheme","typography","fontSize","ThemeProvider","GlobalStyles","styles","ul","margin","padding","listStyle","CssBaseline","Container","component","maxWidth","height","gutterBottom","fontWeight","alignSelf","Card","onClick","CardActionArea","CardContent","Dropzone","zoneHeight","handleFiles","paddingTop","acceptedFiles","onAdd","onAlert","message","Icon","UploadFileIcon","dropzoneText","fileObjects","degiroFiToEn","translateDegiro","key","CoinBaseProHeaderValues","CoinBaseHeaderValues","DegiroHeaderValues","NordnetHeaderValues","decodeUTF16LE","binaryStr","cp","i","length","push","charCodeAt","String","fromCharCode","chooseCSVParser","filesCopy","parsers","a","Promise","all","map","file","parser","fileName","name","inputFile","data","toString","split","fileContentBuffer","atob","str","decodeURIComponent","escape","window","fileContent","parsedData","Error","flatMap","x","loadParser","parse","getDataDegiro","input","parseDegiroCSV","orig","column","getDegiroAsColumns","Degiro","rows","getDataNordnet","parseNordnetCSV","getNordnetAsColumns","Nordnet","getDataCoinbase","parseCoinbaseCSV","getCoinbaseAsColumns","Coinbase","getDataCoinbasePro","parseCoinbaseProCSV","getCoinbaseProAsColumns","CoinbasePro","prevField","tmp","cast","value","context","header","columns","trim","results","record","records","transaction","moment","date","time","toISOString","every","_","difference","sortBy","Object","keys","TypeError","nanoid","Source","id","paivays","datetime","tuote","security","isin","ISIN","arvo","valueCurrency","maara","quantity","kulut","transactionCosts","transactionCostsCurrency","kurssi","rate","rateCurrency","kokonaissumma","totalAmount","totalAmountCurrency","operation","delimiter","includes","replace","Number","parseFloat","toDate","Kauppapaiva","Arvopaperi","Summa","Valuutta","Maara","Kokonaiskulut","Kurssi","Tapahtumatyyppi","startAt","findIndex","o","startsWith","toUpperCase","from_line","Subtotal","QuantityTransacted","SpotPriceatTransaction","SpotPriceCurrency","Timestamp","Asset","Fees","Total","TransactionType","product","pricefeetotalunit","undefined","createdat","size","price","fee","total","side","currencyFormatter","Intl","NumberFormat","style","currency","validateOperation","validateCurrency","currencyInput","currencyFormat","type","valueFormatter","arr","format","e","cellClassName","currencyFormatResults","timeFormat","toLocaleString","year","month","day","hour","minute","second","columnsSecurity","field","headerName","editable","minWidth","preProcessEditCellProps","params","isValid","props","error","columnsCrypto","columnsTransaction","mode","CustomToolbar","paddingLeft","className","gridClasses","toolbarContainer","printOptions","bodyClassName","hideToolbar","hideFooter","allColumns","ResultTable","minHeight","components","Toolbar","ResultCard","content","footer","footerSecondary","contentColor","infoHover","infoDirection","palette","background","paper","text","primary","secondary","action","active","Tooltip","title","placement","Box","bgcolor","boxShadow","borderRadius","p","formatCurrency","display","mx","calculateFIFOTransactions","operationHistory","sortedOperationHistory","filter","reduce","capitalGainPerSellDate","sale","calculateCapitalGainsForSale","calculateFIFOCapitalGains","gainByDate","sumBy","transactions","amountsold","dividedFees","transferFee","transferFeeForSell","transferFeeSummedFromSELLOperation","console","warn","ticker","orderBy","symbol","forEach","buy","amountSold","Math","min","amount","trs","buydate","selldate","transferPrice","profitOrLoss","acquisitionPrice","acquisitionFee","transactionFee","totalPrice","round","timeZone","PreviewTable","rawDataAsColumns","rawDatatSetCallback","useState","cellCommit","setCellCommit","useEffect","row","matchingRow","find","y","newObj","item","fontVariantNumeric","onCellEditCommit","newSelection","parsersCrypto","parsersSecurity","PreviewData","setZoneHeight","files","setFiles","showTable","setShowTable","rowDataColumn","setRowDataColumn","setRawDataAsColumns","originalData","setOriginalData","setResults","parseError","setParseError","errorFifo","setErrorFifo","showCurrencyFetchButton","setShowCurrencyFetchButton","calculatedResults","setCalculatedResults","successFul","uniqBy","errors","err","msg","newRows","result","concat","newRawData","assign","enableCurrencyWarning","invalid","Alert","severity","capitalGains","toFixed","capitalLosses","acquisitionFees","sellprices","pl","paddingBottom","Button","additionlOperationTobeAdded","fixedCurrencies","requestDate","axios","get","unitAsEur","percentageOfFee","totalInEur","totalFee","obj","arrReplacedObj","endIcon","startIcon","disabled","fifoData","coinBaseIssueRows","customOp","coinbaseTMP","issueRow","matchinOrigData","info","Notes","boughAmount","boughtCurrency","correctedCoinbaseData","abs","parseColumnDataToFIFO","finalFifo","idx","minusFees","ReactDOM","render","basename","process","path","element","document","getElementById"],"mappings":"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","file":"static/js/main.f4024a84.chunk.js","sourcesContent":["import Link from '@mui/material/Link';\r\nimport Typography from '@mui/material/Typography';\r\nimport { Stack} from '@mui/material';\r\n\r\nconst Copyright = () => {\r\n    return (\r\n        <Stack\r\n            direction=\"column\"\r\n            justifyContent=\"center\"\r\n            alignItems=\"center\"\r\n            spacing={1}\r\n            width={\"sm\"}\r\n            sx={{ pt: 1, pb: 4 }}\r\n        >\r\n            <Typography variant=\"body2\" sx={{ pt: 4 }} color=\"text.secondary\" align=\"center\" >\r\n                Tarkista tiedot aina itse virheiden varalta.\r\n            </Typography>\r\n            <Typography variant=\"body2\" sx={{ pt: 0 }} color=\"text.secondary\" align=\"center\" >\r\n                Olet itse vastuussa omista veroistasi.\r\n            </Typography>\r\n            <Typography variant=\"body2\" sx={{ pt: 0 }} color=\"text.secondary\" align=\"center\" >\r\n                Sivustolle lähettämiäsi tiedostoja käsitellään vain paikallisesti selaimessasi.\r\n            </Typography>\r\n            <Typography variant=\"body2\" sx={{ pt: 4 }} color=\"text.secondary\" align=\"center\" >\r\n                Huomasitko virheen tai sivusto ei toimi mielestäsi oikein? Ilmoita ongelmastasi&nbsp;\r\n                <Link href=\"https://github.com/jaantaponen/verotunkki/issues/new\">täällä</Link>\r\n            </Typography>\r\n            <Typography variant=\"body2\" sx={{ pt: 0 }} color=\"text.secondary\" align=\"center\" >\r\n                {'Copyright © '}\r\n                <Link color=\"inherit\" href=\"https://verotunkki.fi/\">\r\n                    Verotunkki\r\n                </Link>{' '}\r\n                {new Date().getFullYear()}\r\n                {'.'}\r\n            </Typography>\r\n        </Stack>\r\n    );\r\n}\r\n\r\nexport { Copyright }\r\n","import { Fragment } from 'react'\r\n\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport Grid from '@mui/material/Grid';\r\nimport Link from '@mui/material/Link';\r\nimport GlobalStyles from '@mui/material/GlobalStyles';\r\nimport Container from '@mui/material/Container';\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport Card from '@mui/material/Card';\r\nimport CardContent from '@mui/material/CardContent';\r\nimport CardMedia from '@mui/material/CardMedia';\r\nimport { Copyright } from './Copyright'\r\nimport Typography from '@mui/material/Typography';\r\nimport { CardActionArea, createTheme, Paper, Stack, styled, ThemeProvider } from '@mui/material';\r\n\r\nconst FrontPageContent = () => {\r\n    const navigate = useNavigate();\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        },\r\n    });\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <GlobalStyles styles={{ ul: { margin: 0, padding: 0, listStyle: 'none' } }} />\r\n            <CssBaseline />\r\n            <Container component=\"main\" maxWidth=\"sm\" sx={{ height: '100vh', pt: 8, pb: 4 }}>\r\n                <Stack\r\n                    direction=\"column\"\r\n                    justifyContent=\"space-between\"\r\n                    alignItems=\"space-between\"\r\n                    sx={{ height: '100%', pt: 0, pb: 2 }}\r\n                >\r\n                    <Stack\r\n                        direction=\"column\"\r\n                        justifyContent=\"center\"\r\n                        alignItems=\"center\"\r\n                        spacing={6}\r\n                        width=\"sm\"\r\n                    >\r\n                        <Typography\r\n                            component=\"h1\"\r\n                            variant=\"h3\"\r\n                            align=\"center\"\r\n                            color=\"text.primary\"\r\n                            gutterBottom\r\n                            sx={{ fontWeight: 'bold', pt: 8 }}\r\n                        >\r\n                            VEROTUNKKI\r\n                        </Typography>\r\n                        <Typography alignSelf=\"center\" align=\"center\" variant=\"h6\" sx={{ pt: 3 }} component=\"p\">\r\n                            Verotunkki laskee puolestasi luovutusvoitot ja -tappiot sekä tulostaa verottajayhteensopivan\r\n                            raportin.\r\n                        </Typography>\r\n                        <Typography alignSelf=\"center\" variant=\"h6\" component=\"p\" sx={{ pt: 2 }}>\r\n                            Valitse verotettavan tulon tyyppi:\r\n                        </Typography>\r\n\r\n                        <Container component=\"main\" sx={{ width: '100%', pt: 4, pb: 4 }}>\r\n\r\n                            <Stack\r\n                                direction=\"column\"\r\n                                spacing={6}\r\n                                justifyContent=\"center\"\r\n                                alignItems=\"center\"\r\n           \r\n                            >\r\n                               <Card sx={{ maxWidth: 430,  width: \"100%!important\" }} onClick={() => {\r\n                                    navigate(\"/crypto\");\r\n                                }}>\r\n                                    <CardActionArea>\r\n                                        <CardContent>\r\n                                            <Typography gutterBottom variant=\"h5\" component=\"div\">\r\n                                                Virtuaalivaluutat\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                                Perus hyvä Ethereum.\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                                Tuetut lähteet: <b>Coinbase, Coinbase Pro</b>\r\n                                            </Typography>\r\n                                        </CardContent>\r\n                                    </CardActionArea>\r\n                                </Card>\r\n\r\n                                <Card sx={{ maxWidth: 430,width: \"100%!important\"}} onClick={() => {\r\n                                    navigate(\"/securities\");\r\n                                }}>\r\n                                    <CardActionArea>\r\n                                        <CardContent>\r\n                                            <Typography gutterBottom variant=\"h5\" component=\"div\">\r\n                                                Arvopaperit\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                                Osakkeet ETF:t, rahastot ja muut arvopaperit.\r\n                                            </Typography>\r\n                                            <Typography variant=\"body2\" color=\"text.secondary\">\r\n                                                Tuetut lähteet: <b>Degiro, Nordnet</b>\r\n                                            </Typography>\r\n                                        </CardContent>\r\n                                    </CardActionArea>\r\n                                </Card>\r\n                            </Stack>\r\n                        </Container>\r\n                    </Stack>\r\n                    <Copyright />\r\n                </Stack>\r\n\r\n\r\n            </Container>\r\n\r\n        </ThemeProvider>\r\n    );\r\n}\r\n\r\nexport { FrontPageContent as Frontpage }\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport Container from '@mui/material/Container';\r\nimport { DropzoneAreaBase, FileObject } from 'react-mui-dropzone';\r\nimport UploadFileIcon from '@mui/icons-material/UploadFile';\r\nimport { createTheme, ThemeProvider } from '@mui/material';\r\n\r\n\r\ninterface Props {\r\n    zoneHeight: number,\r\n    handleFiles: (arg0: FileObject[]) => void;\r\n}\r\n\r\nconst Dropzone = ({ zoneHeight, handleFiles }: Props) => {\r\n    \r\n\r\n    const handleAlert = (message: any, variant: any) => {\r\n        //console.log(`${variant}: ${message}`)\r\n    }\r\n    /***\r\n     * \r\n     * TODO REFACTOR ZONEHEIGHT INTO ENUM/BETTER LOGIC\r\n     */\r\n\r\n    return (\r\n        <Container sx={{\r\n            pt: 4, pb: 3,\r\n            width: \"100%\",\r\n            '& .MuiDropzoneArea-textContainer': {\r\n                color: 'black'\r\n            },\r\n            '& .MuiDropzoneArea-text': {\r\n                paddingTop: zoneHeight > 200 ? 8 : 4,\r\n                fontSize: 20,\r\n            },\r\n            '& .MuiDropzoneArea-root': {\r\n                height: zoneHeight,\r\n            },\r\n        }}>\r\n            <DropzoneAreaBase\r\n                acceptedFiles={['text/x-csv', 'text/plain', 'application/vnd.ms-excel', 'application/x-csv', 'application/csv', 'text/csv', 'text/comma-separated-values', 'text/x-comma-separated-values', 'text/tab-separated-values']}\r\n                onAdd={handleFiles}\r\n                onAlert={handleAlert}\r\n                Icon={UploadFileIcon as any}\r\n                dropzoneText={zoneHeight > 200 ? \"Pudota CSV-tiedostoja tähän\" : \"Pudota lisää CSV-tiedostoja tähän\"}\r\n                fileObjects={[]}\r\n            />\r\n        </Container>\r\n    );\r\n}\r\n\r\nexport { Dropzone }","const degiroFiToEn = {\n    \"Päiväys\": \"date\",\n    \"Aika\": \"time\",\n    \"Tuote\": \"security\",\n    \"ISIN\": \"ISIN\",\n    \"Reference\": \"reference\",\n    \"Venue\": \"venue\",\n    \"Quantity\": \"quantity\",\n    \"Kurssi\": \"rate\",\n    \"Kurssi-valuutta\": \"rateCurrency\",\n    \"Markkina-arvo\": \"marketValue\",\n    \"Markkina-arvo-valuutta\": \"marketValueCurrency\",\n    \"Value\": \"value\",\n    \"Value-valuutta\": \"valueCurrency\",\n    \"Vaihtokurssi\": \"exchangeRate\",\n    \"Transaction costs\": \"transactionCosts\",\n    \"Transaction and/or third\": \"transactionCosts\",\n    \"Transaction and/or third-valuutta\": \"transactionCostsCurrency\",\n    \"Transaction costs-valuutta\": \"transactionCostsCurrency\",\n    \"Kokonaissumma\": \"totalAmount\",\n    \"Kokonaissumma-valuutta\": \"totalAmountCurrency\",\n    \"Order ID\": \"orderId\"\n}\n\nconst translateDegiro = (key: keyof typeof degiroFiToEn) => {\n    if (degiroFiToEn[key]) {\n        return degiroFiToEn[key]\n    }\n}\n\nexport default translateDegiro;","export interface DegiroHeaders {\n  readonly id: string;\n  time: string;\n  security: string;\n  ISIN: string;\n  reference: string;\n  venue: string;\n  quantity: number;\n  rate: number;\n  rateCurrency: string;\n  marketValue: number;\n  marketValueCurrency: string;\n  value: number;\n  valueCurrency: string;\n  exchangeRate: number;\n  transactionCosts: number;\n  transactionCostsCurrency: string;\n  totalAmount: number;\n  totalAmountCurrency: string;\n  orderId: string;\n  datetime: Date;\n  Source: \"Degiro\";\n  Error?: string;\n}\n\nexport interface CoinbaseHeaders {\n  readonly id: string;\n  Timestamp: Date;\n  TransactionType: \"BUY\" | \"SELL\" | \"RECEIVE\" | \"CONVERT\" | \"COINBASE EARN\";\n  Asset: string;\n  QuantityTransacted: number;\n  SpotPriceCurrency: string;\n  SpotPriceatTransaction: number;\n  Subtotal: number;\n  Total: number;\n  Fees: number;\n  Notes: string;\n  Source: \"Coinbase\";\n  Error?: string;\n}\n\nexport interface NordnetHeaders {\n  readonly id: string;\n  Id: string;\n  Kirjauspaiva: Date;\n  Kauppapaiva: Date;\n  Maksupaiva: string;\n  Salkku: string;\n  Tapahtumatyyppi: string;\n  Arvopaperi: string;\n  Instrumenttityyppi: string;\n  ISIN: string;\n  Maara: number;\n  Kurssi: number;\n  Korko: string;\n  Kokonaiskulut: number;\n  KokonaiskulutValuutta: string;\n  Summa: number;\n  Valuutta: string;\n  Hankintaarvo: string;\n  Tulos: string;\n  Kokonaismaara: number;\n  Saldo: string;\n  Vaihtokurssi: string;\n  Tapahtumateksti: string;\n  Mitatointipaiva: string;\n  Laskelma: string;\n  Vahvistusnumero: string;\n  Valityspalkkio: number;\n  ValityspalkkioValuutta: string;\n  Source: \"Nordnet\";\n  Error?: string;\n}\n\nexport interface CoinbaseProHeaders {\n  readonly id: string;\n  portfolio: string;\n  tradeid: string;\n  product: string;\n  side: string;\n  createdat: Date;\n  size: number;\n  sizeunit: string;\n  price: number;\n  fee: number;\n  total: number;\n  pricefeetotalunit: string;\n  Source: \"CoinbasePro\"\n  Error?: string;\n}\n\nexport const CoinBaseProHeaderValues = [\n  \"portfolio\",\n  \"tradeid\",\n  \"product\",\n  \"side\",\n  \"createdat\",\n  \"size\",\n  \"sizeunit\",\n  \"price\",\n  \"fee\",\n  \"total\",\n  \"pricefeetotalunit\"\n]\n\nexport const CoinBaseHeaderValues = [\n  'Timestamp',\n  'TransactionType',\n  'Asset',\n  'QuantityTransacted',\n  'SpotPriceCurrency',\n  'SpotPriceatTransaction',\n  'Subtotal',\n  'Total',\n  'Fees',\n  'Notes',\n]\n\nexport const DegiroHeaderValues = [\n  'date',\n  'time',\n  'security',\n  'ISIN',\n  'reference',\n  'venue',\n  'quantity',\n  'rate',\n  'rateCurrency',\n  'marketValue',\n  'marketValueCurrency',\n  'value',\n  'valueCurrency',\n  'exchangeRate',\n  'transactionCosts',\n  'transactionCostsCurrency',\n  'totalAmount',\n  'totalAmountCurrency',\n  'orderId',\n  'datetime'\n]\n\nexport const NordnetHeaderValues = [\n  'Id', 'Kirjauspaiva',\n  'Kauppapaiva', 'Maksupaiva',\n  'Salkku', 'Tapahtumatyyppi',\n  'Arvopaperi', 'Instrumenttityyppi',\n  'ISIN', 'Maara',\n  'Kurssi', 'Korko',\n  'Kokonaiskulut', 'KokonaiskulutValuutta',\n  'Summa', 'Valuutta',\n  'Hankintaarvo', 'Tulos',\n  'Kokonaismaara', 'Saldo',\n  'Vaihtokurssi', 'Tapahtumateksti',\n  'Mitatointipaiva', 'Laskelma',\n  'Vahvistusnumero', 'Valityspalkkio',\n  'ValityspalkkioValuutta'\n]\n","import _ from \"lodash\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { FileObject } from \"react-mui-dropzone\";\r\nimport { rawDatas, resultFromParse } from \"../../components/PreviewData\";\r\nimport { ColumnDataCrypto, ColumnDataSecurity } from \"../../components/tableSettings\";\r\nimport { Operation } from \"../fifo\";\r\nimport { getCoinbaseAsColumns } from \"./loadTransactions\";\r\nimport { CoinbaseHeaders } from \"./types\";\r\n\r\n/**\r\n * Workaround for browsers.\r\n * https://developer.mozilla.org/en-US/docs/Glossary/Base64#solution_1_%E2%80%93_escaping_the_string_before_encoding_it\r\n */\r\nconst b64_to_utf8 = (str: string) => (decodeURIComponent(escape(window.atob(str))))\r\n\r\nconst decodeUTF16LE = (binaryStr: string) => {\r\n    const cp = [];\r\n    for (let i = 0; i < binaryStr.length; i += 2)\r\n        cp.push(binaryStr.charCodeAt(i) | (binaryStr.charCodeAt(i + 1) << 8));\r\n    return String.fromCharCode(...cp);\r\n}\r\n\r\n/**\r\n * Gets the current file and checks it againts parsers.\r\n * @param filesCopy \r\n * @returns headers\r\n */\r\nconst chooseCSVParser = async (filesCopy: FileObject[], parsers: any[]): Promise<resultFromParse[]> => {\r\n    const a = await Promise.all(filesCopy.map(async file => {\r\n        return await Promise.all(parsers.map(async parser => {\r\n            const fileName = file.file.name\r\n            try {\r\n                const inputFile = file.data ? file.data.toString().split(',')[1] : \"\"\r\n                const fileContentBuffer = parser.name === 'getDataNordnet' ? decodeUTF16LE(atob(inputFile)) : b64_to_utf8(inputFile)\r\n                const fileContent = fileContentBuffer.toString()\r\n                const parsedData = await parser(fileContent)\r\n                parsedData.fileName = fileName\r\n                return parsedData\r\n            } catch (e: any) {\r\n                return { Error: e, fileName: fileName }\r\n            }\r\n        }))\r\n    })) as resultFromParse[]\r\n    return a.flatMap(x => x)\r\n}\r\n\r\n/**\r\n * Due to Jest (26.x.x) being the latest stable release, we have to default to commonjs module for tests.\r\n * The ESM module support through Babel was not sufficient and resulted in different behaviour. \r\n * @returns parse function\r\n */\r\nconst loadParser: any = async () => (process.env.NODE_ENV === 'test' ?\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore  \r\n    (await import('csv/dist/cjs/sync.cjs')).parse :\r\n    (await import('csv/dist/esm/sync')).parse\r\n)\r\n\r\n\r\nconst parseColumnDataToFIFO = (rawDataAsColumns: ColumnDataSecurity[] | ColumnDataCrypto[], originalData: rawDatas): Operation[] => {\r\n    const coinBaseIssueRows = rawDataAsColumns.filter(customOp => (customOp.operation === 'CONVERT' ||\r\n        customOp.operation === 'COINBASE EARN' ||\r\n        customOp.operation === 'RECEIVE') &&\r\n        originalData['Coinbase'].map(x => x.id).includes(customOp.id)) as ColumnDataCrypto[]\r\n\r\n    const coinbaseTMP: CoinbaseHeaders[] = []\r\n    coinBaseIssueRows.forEach(issueRow => {\r\n        const matchinOrigData = originalData['Coinbase']?.find(x => x.id === issueRow.id)\r\n        if (matchinOrigData?.TransactionType === 'CONVERT') {\r\n            const info = matchinOrigData.Notes.split(' ')\r\n            //const soldAmount = info[1]\r\n            //const soldCurrency = info[2]\r\n            const boughAmount = Number(info[4])\r\n            const boughtCurrency = info[5]\r\n            coinbaseTMP.push({\r\n                ...matchinOrigData,\r\n                TransactionType: \"SELL\",\r\n                id: nanoid(10),\r\n                Fees: 0,\r\n                Total: matchinOrigData.Total - matchinOrigData.Fees\r\n            })\r\n            coinbaseTMP.push({\r\n                ...matchinOrigData,\r\n                TransactionType: \"BUY\",\r\n                id: nanoid(10),\r\n                Asset: boughtCurrency,\r\n                QuantityTransacted: boughAmount,\r\n                SpotPriceatTransaction: matchinOrigData.Subtotal / boughAmount\r\n            })\r\n        } else if (matchinOrigData?.TransactionType === 'COINBASE EARN') {\r\n            coinbaseTMP.push({\r\n                ...matchinOrigData,\r\n                TransactionType: \"BUY\",\r\n            })\r\n        } else if (matchinOrigData?.TransactionType === 'RECEIVE') {\r\n            coinbaseTMP.push({\r\n                ...matchinOrigData,\r\n                TransactionType: \"BUY\",\r\n            })\r\n        }\r\n    })\r\n\r\n    const correctedCoinbaseData = getCoinbaseAsColumns(coinbaseTMP)\r\n    // We do not need filter by unique since other operations than BUY and SELL are filtered below.\r\n    const combined = rawDataAsColumns.concat(correctedCoinbaseData ? correctedCoinbaseData as any : [])\r\n\r\n    const fifoData = combined\r\n        .filter(type => type.operation === 'BUY' || type.operation === 'SELL')\r\n        .map(transaction => {\r\n            return {\r\n                symbol: transaction.tuote,\r\n                date: transaction.paivays,\r\n                price: Math.abs(Number(transaction.kurssi.split(' ')[0])),\r\n                amount: Math.abs((transaction.maara)),\r\n                type: transaction.operation as \"BUY\" | \"SELL\",\r\n                transactionFee: Math.abs(Number(transaction.kulut.split(' ')[0])),\r\n            }\r\n        })\r\n    return fifoData as Operation[]\r\n}\r\n\r\n\r\n\r\nexport { chooseCSVParser, loadParser, parseColumnDataToFIFO }","import translateDegiro from './translations'\nimport moment from 'moment';\nimport 'moment-timezone';\nimport { Operation } from '../fifo/types'\nimport { DegiroHeaders, CoinbaseHeaders, CoinbaseProHeaders, CoinBaseProHeaderValues, CoinBaseHeaderValues, DegiroHeaderValues, NordnetHeaderValues, NordnetHeaders } from './types'\nimport { ColumnDataCrypto, ColumnDataSecurity } from '../../components/tableSettings'\nimport _ from 'lodash';\nimport { nanoid } from 'nanoid/async'\nimport { loadParser } from './helpers';\n\n\nconst getDataDegiro = async (input: string) => {\n    const orig = await parseDegiroCSV(input)\n    const column = getDegiroAsColumns(orig)\n    return {\n        orig: {Degiro : orig},\n        rows: column\n    }\n}\n\nconst getDataNordnet = async (input: string) => {\n    const orig = await parseNordnetCSV(input)\n    const column = getNordnetAsColumns(orig)\n    return {\n        orig: {Nordnet : orig},\n        rows: column\n    }\n}\nconst getDataCoinbase = async (input: string) => {\n    const orig = await parseCoinbaseCSV(input)\n    const column = getCoinbaseAsColumns(orig)\n    return {\n        orig: {Coinbase : orig},\n        rows: column\n    }\n}\n\nconst getDataCoinbasePro = async (input: string) => {\n    const orig = await parseCoinbaseProCSV(input)\n    const column = getCoinbaseProAsColumns(orig)\n    return {\n        orig: {CoinbasePro : orig},\n        rows: column\n    }\n}\n\n\n/**\n * \n * ************DEGIRO FUNCTIONS********************\n *\n */\n\nconst parseDegiroCSV = async (input: string): Promise<DegiroHeaders[]> => {\n    let prevField = \"\"\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value === '') return translateDegiro(`${prevField}-valuutta` as any);\n                prevField = value\n                return translateDegiro(value)\n            }\n            return String(value)\n        },\n        columns: true,\n        trim: true,\n    });\n\n    const results = []\n    for await (const record of tmp) results.push(record)\n    const records: DegiroHeaders[] = results.map((transaction: any) => {\n        transaction['datetime'] = moment(`${transaction.date}-${transaction.time}`, \"DD-MM-YYYY-HH-mm\").toISOString()\n        return transaction\n    })\n\n    if (results.every(x => _.difference(_.sortBy(DegiroHeaderValues), _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Degiro file.')\n    }\n\n    return (await Promise.all(records.map(async x => ({\n        ...x, Source: \"Degiro\", id: (await nanoid(10))\n    })))) as DegiroHeaders[]\n\n}\n\nconst getDegiroAsColumns = (records: DegiroHeaders[]): ColumnDataSecurity[] => {\n    const ret = records.map(record => {\n        return {\n            id: record.id,\n            paivays: new Date(record.datetime),\n            tuote: record.security,\n            isin: record.ISIN,\n            arvo: `${record.value} ${record.valueCurrency}`,\n            maara: record.quantity,\n            kulut: `${record.transactionCosts} ${record.transactionCostsCurrency}`,\n            kurssi: `${record.rate} ${record.rateCurrency}`,\n            kokonaissumma: `${record.totalAmount} ${record.totalAmountCurrency}`,\n            operation: record.quantity > 0 ? \"BUY\" : \"SELL\",\n        } as ColumnDataSecurity\n    })\n    return ret\n}\n\nconst prepareDegiroForFIFO = (rawData: DegiroHeaders[]): Operation[] => {\n    return rawData\n        .map(record => {\n            return {\n                symbol: record.security,\n                date: record.datetime,\n                price: record.rate,\n                amount: record.quantity,\n                type: record.quantity > 0 ? \"BUY\" : \"SELL\",\n                transactionFee: Math.abs(record.transactionCosts),\n            }\n        })\n}\n\n\n/**\n * \n * ************NORDNET FUNCTIONS********************\n *\n */\n\nconst parseNordnetCSV = async (input: string): Promise<NordnetHeaders[]> => {\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        delimiter: [\"\\t\"],\n        columns: true,\n        trim: true,\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                let header = value\n                if (header.includes('ä')) header = header.replace(/ä/g, 'a')\n                if (header.includes('ö')) header = header.replace(/ö/g, 'o')\n                if (header.includes('-')) header = header.replace(/-/g, '')\n                return header.replace(/\\s/g, '')\n            }\n            const column = context.column\n            //these are probably unneeded\n            if (column === 'Maara' ||\n                column === 'Kurssi' ||\n                column === 'Valityspalkkio' ||\n                column === 'Summa' ||\n                column === 'Kokonaiskulut' ||\n                column === 'Kokonaismaara') return Number.parseFloat(value.replace(/,/g, '.'));\n            if (column === 'Kirjauspaiva' ||\n                column === 'Kauppapaiva' ||\n                column === 'Maksupaiva') return moment(value, \"YYYY-MM-DD\").toDate()\n            return String(value)\n        },\n    })\n\n    const results = []\n    for await (const record of tmp) {\n        results.push(record)\n    }\n\n    if (results.every(x => _.difference(NordnetHeaderValues, _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Nordnet file.')\n    }\n\n    return (await Promise.all(results.map(async x => ({\n        ...x, Source: \"Nordnet\", id: (await nanoid(10))\n    })))) as NordnetHeaders[]\n}\n\nconst getNordnetAsColumns = (records: NordnetHeaders[]): ColumnDataSecurity[] => {\n    const ret = records.map(record => {\n        return {\n            id: record.id,\n            paivays: new Date(record.Kauppapaiva),\n            tuote: record.Arvopaperi,\n            isin: record.ISIN,\n            arvo: `${record.Summa} ${record.Valuutta}`,\n            maara: record.Maara,\n            kulut: record.Kokonaiskulut.toString(),\n            kurssi: `${record.Kurssi} ${record.Valuutta}`,\n            kokonaissumma: `${record.Summa - record.Kokonaiskulut} ${record.Valuutta}`,\n            operation: record.Tapahtumatyyppi,\n        } as ColumnDataSecurity\n    })\n    return ret\n}\n\n\nconst prepareNordnetForFIFO = (rawData: NordnetHeaders[]): Operation[] => {\n    return rawData\n        .filter(x => x.Tapahtumatyyppi === 'MYYNTI' || x.Tapahtumatyyppi === 'OSTO')\n        .map(record => {\n            return {\n                symbol: record.Arvopaperi,\n                date: record.Kauppapaiva,\n                price: record.Kurssi,\n                amount: record.Maara,\n                type: record.Tapahtumatyyppi === 'OSTO' ? \"BUY\" : \"SELL\",\n                transactionFee: record.Kokonaiskulut,\n            }\n        })\n}\n\n\n\n/**\n * \n * ************COINBASE FUNCTIONS********************\n *\n */\n\nconst parseCoinbaseCSV = async (input: string): Promise<CoinbaseHeaders[]> => {\n    const startAt = _.findIndex(input?.split('\\n'), (o) => o?.startsWith('Timestamp,Transaction'))\n    const parse = await loadParser()\n    const results = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value.includes('(')) return value.split('(')[0].replace(/\\s/g, '')\n                return value.replace(/\\s/g, '')\n            }\n            if (context.column === 'Timestamp') return moment(value, \"YYYY-MM-DD-HH-mm-ss\").toISOString()\n            if (context.column === 'TransactionType') return value.toUpperCase()\n            return String(value)\n        },\n        columns: true,\n        from_line: startAt > 0 ? startAt + 1 : 1,\n        trim: true,\n    })\n    if (results.every((x: any) => _.difference(CoinBaseHeaderValues, _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Coinbase file.')\n    }\n\n    return (await Promise.all(results.map(async (x: any) => ({\n        ...x, Source: \"Coinbase\", id: (await nanoid(10))\n    })))) as CoinbaseHeaders[]\n}\n\nconst prepareCoinbaseForFIFO = (rawData: CoinbaseHeaders[]): Operation[] => {\n    const prepareRawFifo: CoinbaseHeaders[] = []\n    rawData.forEach(statement => {\n        if (statement.TransactionType === 'CONVERT') {\n            const info = statement.Notes.split(' ')\n            //const soldAmount = info[1]\n            //const soldCurrency = info[2]\n            const boughAmount = Number(info[4])\n            const boughtCurrency = info[5]\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"SELL\",\n                Fees: 0,\n                Total: statement.Total - statement.Fees\n            })\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n                Asset: boughtCurrency,\n                QuantityTransacted: boughAmount,\n                SpotPriceatTransaction: statement.Subtotal / boughAmount\n            })\n        } else if (statement.TransactionType === 'COINBASE EARN') {\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n            })\n        } else if (statement.TransactionType === 'RECEIVE') {\n            prepareRawFifo.push({\n                ...statement,\n                TransactionType: \"BUY\",\n            })\n        }\n    })\n\n    const dataFifo: Operation[] = rawData.concat(prepareRawFifo)\n        .filter(x => x.TransactionType === 'BUY' || x.TransactionType === 'SELL')\n        .map(record => {\n            return {\n                symbol: record.Asset,\n                date: new Date(record.Timestamp),\n                price: Number(record.SpotPriceatTransaction),\n                amount: Number(record.QuantityTransacted),\n                type: record.TransactionType as \"BUY\" | \"SELL\",\n                transactionFee: Number(record.Fees ?? 0),\n            }\n        })\n    return dataFifo\n\n}\n\n\nconst getCoinbaseAsColumns = (records: CoinbaseHeaders[]): ColumnDataCrypto[] => {\n    const ret = records.map(record => {\n        const value = `${record.Subtotal ?\n            Number(record.Subtotal) : (record.QuantityTransacted * record.SpotPriceatTransaction)} ${record.SpotPriceCurrency}`\n        return {\n            id: record.id,\n            paivays: record.Timestamp,\n            tuote: record.Asset,\n            arvo: value,\n            maara: Number(record.QuantityTransacted),\n            kulut: `${Number(record.Fees) ? Number(record.Fees) : 0} ${record.SpotPriceCurrency}`,\n            kurssi: `${record.SpotPriceatTransaction} ${record.SpotPriceCurrency}`,\n            kokonaissumma: `${Number(record.Total ? record.Total : 0)} ${record.SpotPriceCurrency}`,\n            operation: record.TransactionType,\n        } as ColumnDataCrypto\n    })\n    return ret\n}\n\n/**\n * \n * ************COINBASE PRO FUNCTIONS********************\n *\n */\n\nconst parseCoinbaseProCSV = async (input: string): Promise<CoinbaseProHeaders[]> => {\n    const parse = await loadParser()\n    const tmp = parse(input, {\n        cast: (value: any, context: any) => {\n            if (context.header) {\n                if (value.includes('/')) return value.replace(/\\//g, '').replace(/\\s/g, '')\n                return value.replace(/\\s/g, '')\n            }\n            if (context.column === 'createdat') return new Date(value).toISOString()\n            return String(value)\n        },\n        columns: true,\n        trim: true,\n    })\n\n    const results = []\n    for await (const record of tmp) results.push(record)\n\n\n    if (results.every(x => _.difference(_.sortBy(CoinBaseProHeaderValues), _.sortBy(Object.keys(x))).length !== 0)) {\n        throw TypeError('All headers not found in the provided Coinbase Pro file.')\n    }\n\n    return (await Promise.all(results.map(async (x: any) => ({\n        ...x, Source: \"CoinbasePro\",\n        product: x.product.split('-')[0],\n        Error: (x.pricefeetotalunit !== \"EUR\" ? \"Invalid currency detected\" : undefined),\n        id: (await nanoid(10))\n    })))) as CoinbaseProHeaders[]\n}\n\nconst getCoinbaseProAsColumns = (records: CoinbaseProHeaders[]): ColumnDataCrypto[] => {\n    const ret = records.map(record => {\n        return {\n            id: record.id,\n            paivays: record.createdat,\n            tuote: record.product,\n            arvo: `${record.size * record.price} ${record.pricefeetotalunit}`,\n            maara: record.size,\n            kulut: `${record.fee ?? record.fee} ${record.pricefeetotalunit}`,\n            kurssi: `${record.price} ${record.pricefeetotalunit}`,\n            kokonaissumma: `${record.total} ${record.pricefeetotalunit}`,\n            operation: record.side,\n        } as ColumnDataCrypto\n    })\n    return ret\n}\n\n\nconst prepareCoinbaseProForFIFO = (rawData: CoinbaseProHeaders[]): Operation[] => {\n    return rawData\n        .filter(x => x.side === 'BUY' || x.side === 'SELL')\n        .map(record => {\n            return {\n                symbol: record.product,\n                date: new Date(record.createdat),\n                price: Number(record.price),\n                amount: Number(record.size),\n                type: record.side as \"BUY\" | \"SELL\",\n                transactionFee: Number(record.fee),\n            }\n        })\n}\n\nexport {\n    parseCoinbaseCSV,\n    parseDegiroCSV,\n    parseNordnetCSV,\n    getDegiroAsColumns,\n    getCoinbaseAsColumns,\n    prepareCoinbaseForFIFO,\n    parseCoinbaseProCSV,\n    getCoinbaseProAsColumns,\n    prepareCoinbaseProForFIFO,\n    getNordnetAsColumns,\n    prepareNordnetForFIFO,\n    prepareDegiroForFIFO,\n    getDataDegiro,\n    getDataNordnet,\n    getDataCoinbase,\n    getDataCoinbasePro,\n}\n","import { GridColTypeDef, GridColumns } from '@mui/x-data-grid';\r\n\r\nexport interface ColumnTransaction {\r\n    id: 'ticker' | 'buydate' | 'selldate' | 'amountsold' | 'transferPrice' | 'acquisitionPrice' | 'acquisitionFee' | 'transferFee' | 'profitOrLoss';\r\n    label: string;\r\n    minWidth?: number;\r\n    align?: 'right';\r\n    format?: (value: number) => string;\r\n}\r\n\r\nexport const currencyFormatter = (value: any) => new Intl.NumberFormat('fi-FI', {\r\n    style: 'currency',\r\n    currency: value,\r\n});\r\n\r\nconst validateOperation = (operation: any) => {\r\n    return operation === \"BUY\" || operation === \"SELL\"\r\n}\r\n\r\nconst validateCurrency = (currencyInput: any) => {\r\n    const string = String(currencyInput) ?? \"\"\r\n    return string.split(' ').length === 2\r\n}\r\n\r\nconst currencyFormat: GridColTypeDef = {\r\n    type: 'string',\r\n    valueFormatter: ({ value }) => {\r\n        const str = String(value) ? String(value) : \"0 EUR\"\r\n        const arr = str.split(' ').length === 2 ? str.split(' ') : \"0 EUR\"\r\n        try {\r\n            return currencyFormatter(arr[1]).format(Number(arr[0]))\r\n        } catch (e) {\r\n            return str\r\n        }\r\n\r\n    },\r\n    cellClassName: 'font-tabular-nums',\r\n};\r\n\r\nconst currencyFormatResults: GridColTypeDef = {\r\n    type: 'number',\r\n    valueFormatter: ({ value }) => {\r\n        const str = String(value) ? String(value) : \"0 EUR\"\r\n        const arr = str.split(' ').length === 2 ? str.split(' ') : \"0 EUR\"\r\n        try {\r\n            return currencyFormatter(arr[1]).format(Number(arr[0]))\r\n        } catch (e) {\r\n            return new Intl.NumberFormat('fi-FI', {\r\n                style: 'currency',\r\n                currency: \"EUR\",\r\n            }).format(Number(str))\r\n        }\r\n\r\n    },\r\n    cellClassName: 'font-tabular-nums',\r\n};\r\n\r\nconst timeFormat: GridColTypeDef = {\r\n    type: 'dateTime',\r\n    valueFormatter: ({ value }) => {\r\n        const date = new Date(value as any);\r\n        const options: any = {\r\n            year: \"numeric\",\r\n            month: \"2-digit\",\r\n            day: \"2-digit\",\r\n            hour: \"2-digit\",\r\n            minute: \"2-digit\",\r\n            second: \"2-digit\"\r\n        };\r\n\r\n        return date.toLocaleString(\"en-GB\", options);\r\n    },\r\n    cellClassName: 'font-tabular-nums',\r\n};\r\n\r\nconst columnsSecurity: GridColumns = [\r\n    { field: 'paivays', headerName: 'Paivays', ...timeFormat, editable: true, minWidth: 180, },\r\n    {\r\n        field: 'operation', headerName: 'Operaatio', type: 'string', editable: true, minWidth: 40,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateOperation(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    { field: 'tuote', headerName: 'Tuote', type: 'string', editable: true, minWidth: 240 },\r\n    {\r\n        field: 'arvo', headerName: 'Arvo', editable: true, minWidth: 120,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    { field: 'maara', headerName: 'Määrä (kpl)', type: 'number', editable: true, minWidth: 50 },\r\n    {\r\n        field: 'kurssi', headerName: 'Kurssi', editable: true, minWidth: 120,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    {\r\n        field: 'kulut', headerName: 'Kulut', type: 'number', editable: true, minWidth: 110,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    {\r\n        field: 'kokonaissumma', headerName: 'Kokonaissumma', editable: true, minWidth: 170,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n];\r\n\r\n\r\n\r\n\r\nconst columnsCrypto: GridColumns = [\r\n    { field: 'paivays', headerName: 'Paivays', ...timeFormat, editable: true, minWidth: 180, },\r\n    {\r\n        field: 'operation', headerName: 'Operaatio', type: 'string', editable: true, minWidth: 140,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateOperation(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    { field: 'tuote', headerName: 'Tuote', type: 'string', editable: true, minWidth: 120 },\r\n    {\r\n        field: 'arvo', headerName: 'Arvo', editable: true, minWidth: 120,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    { field: 'maara', headerName: 'Määrä (kpl)', type: 'number', editable: true, minWidth: 120 },\r\n    {\r\n        field: 'kurssi', headerName: 'Kurssi', editable: true, minWidth: 120,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    {\r\n        field: 'kulut', headerName: 'Kulut', type: 'number', editable: true, minWidth: 110,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n    {\r\n        field: 'kokonaissumma', headerName: 'Kokonaissumma', editable: true, minWidth: 170,\r\n        ...currencyFormat,\r\n        preProcessEditCellProps: (params) => {\r\n            const isValid = validateCurrency(params.props.value);\r\n            return { ...params.props, error: !isValid };\r\n        },\r\n    },\r\n];\r\n\r\n\r\nconst columnsTransaction = (mode: 'CRYPTO' | 'SECURITY'): GridColumns => [\r\n    { field: 'ticker', headerName: 'Tuote', type: 'string', editable: false, minWidth: mode === 'CRYPTO' ? 50: 250 },\r\n    { field: 'buydate', headerName: 'Hankintapäivä', type: 'date', editable: false, minWidth: 120 },\r\n    { field: 'selldate', headerName: 'Luovutuspäivä', type: 'date', editable: false, minWidth: 120 },\r\n    { field: 'amountsold', headerName: 'Myyty kpl', type: 'number', editable: false, minWidth: 50 },\r\n    {\r\n        field: 'transferPrice', headerName: 'Luovutushinta', editable: false, minWidth: 120, ...currencyFormatResults,\r\n    },\r\n    { field: 'acquisitionPrice', headerName: 'Hankintahinta', ...currencyFormatResults, editable: false, minWidth: 120 },\r\n    { field: 'acquisitionFee', headerName: 'Hankintakulut', ...currencyFormatResults, editable: false, minWidth: 120 },\r\n    { field: 'transferFee', headerName: 'Luovutuskulut', ...currencyFormatResults, editable: false, minWidth: 120 },\r\n    { field: 'profitOrLoss', headerName: 'Voitto/Tappio', ...currencyFormatResults, editable: false, minWidth: 120 },\r\n];\r\n\r\n\r\nexport interface ColumnDataSecurity {\r\n    readonly id: string;\r\n    paivays: Date;\r\n    tuote: string;\r\n    isin: string;\r\n    arvo: string;\r\n    maara: number;\r\n    kulut: string;\r\n    kurssi: string;\r\n    kokonaissumma: string;\r\n    operation: string;\r\n}\r\n\r\n\r\nexport interface ColumnDataCrypto {\r\n    readonly id: string;\r\n    paivays: Date;\r\n    operation: string;\r\n    tuote: string;\r\n    arvo: string;\r\n    maara: number;\r\n    kulut: string;\r\n    kurssi: string;\r\n    kokonaissumma: string;\r\n}\r\n\r\n\r\nexport interface ColumnDataTransaction {\r\n    readonly id: number;\r\n    ticker: string\r\n    buydate: Date\r\n    selldate: Date\r\n    amountsold: number\r\n    transferPrice: number\r\n    acquisitionPrice: number\r\n    acquisitionFee: number\r\n    transferFee: string\r\n    profitOrLoss: string\r\n}\r\n\r\n\r\n\r\nexport { columnsSecurity, columnsCrypto, columnsTransaction }\r\n","import { columnsTransaction, ColumnDataTransaction } from './tableSettings'\r\nimport {\r\n    DataGrid,\r\n    GridToolbarContainer,\r\n    GridToolbarExport,\r\n    gridClasses,\r\n    GridRowsProp\r\n} from '@mui/x-data-grid';\r\n\r\nimport './printTableStyles.css'\r\n\r\ninterface Props {\r\n    rows: ColumnDataTransaction[],\r\n    mode: 'CRYPTO' | 'SECURITY'\r\n}\r\n\r\nconst CustomToolbar = () => {\r\n    return (\r\n        <GridToolbarContainer style={{paddingLeft: 24}} className={gridClasses.toolbarContainer}>\r\n            <GridToolbarExport printOptions={{\r\n                bodyClassName: \"printTableStyles\", hideToolbar: true, hideFooter: true, allColumns: true\r\n            }}\r\n            />\r\n        </GridToolbarContainer>\r\n    );\r\n}\r\n\r\nconst ResultTable = ({ rows, mode }: Props) => {\r\n    return (<div style={{ width: '100%' }}>\r\n        <DataGrid\r\n            sx={{\r\n                minHeight: 700,\r\n            }}\r\n            rows={rows as GridRowsProp}\r\n            columns={columnsTransaction(mode)}\r\n            components={{\r\n                Toolbar: CustomToolbar,\r\n            }}\r\n        />\r\n    </div>\r\n\r\n    )\r\n}\r\n\r\nexport { ResultTable }\r\n","\r\nimport { Alert, Box, Button, createTheme, Paper, Stack, styled, Table, TableBody, TableCell, TableContainer, TableHead, TablePagination, TableRow, ThemeProvider } from '@mui/material';\r\nimport { currencyFormatter } from './tableSettings';\r\nimport Tooltip from '@mui/material/Tooltip';\r\ninterface Props {\r\n    header: string,\r\n    content: string,\r\n    contentColor: string,\r\n    footer: string,\r\n    footerSecondary: string,\r\n    infoHover: string,\r\n    infoDirection?: \"top\" | \"right\" | \"bottom\" | \"left\" | \"bottom-end\" | \"bottom-start\" | \"left-end\" | \"left-start\" | \"right-end\" | \"right-start\" | \"top-end\" | \"top-start\" | undefined\r\n}\r\n\r\n\r\nconst ResultCard = ({ header, content, footer, footerSecondary, contentColor, infoHover,infoDirection }: Props) => {\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        },\r\n        palette: {\r\n            background: {\r\n                paper: '#fff',\r\n            },\r\n            text: {\r\n                primary: '#173A5E',\r\n                secondary: '#46505A',\r\n            },\r\n            action: {\r\n                active: '#001E3C',\r\n            }\r\n        }\r\n    });\r\n\r\n    const formatCurrency = (value: string) => {\r\n        try {\r\n            return currencyFormatter(\"EUR\").format(Number(value))\r\n        } catch {\r\n            return value\r\n        }\r\n    }\r\n\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <Tooltip title={infoHover} placement={infoDirection}>\r\n                <Box\r\n                    sx={{\r\n                        bgcolor: 'background.paper',\r\n                        boxShadow: 1,\r\n                        borderRadius: 1,\r\n                        p: 2,\r\n                        minWidth: 350,\r\n                    }}\r\n                >\r\n                    <Box sx={{ color: 'text.secondary' }}>{header}</Box>\r\n                    <Box sx={{ color: 'text.primary', fontSize: 30, fontWeight: 'medium' }}>\r\n                        {formatCurrency(content)}\r\n                    </Box>\r\n                    <Box\r\n                        sx={{\r\n                            color: contentColor,\r\n                            display: 'inline',\r\n                            fontWeight: 'medium',\r\n                            mx: 0.5,\r\n                        }}\r\n                    >\r\n                        {footer}\r\n                    </Box>\r\n                    <Box sx={{ color: 'text.secondary', display: 'inline', fontSize: 12 }}>\r\n                        {footerSecondary}\r\n                    </Box>\r\n                </Box>\r\n            </Tooltip>\r\n        </ThemeProvider>)\r\n}\r\n\r\nexport { ResultCard }","import { Operation, Transaction } from './types';\nimport _ from 'lodash';\n\nexport interface CapitalResults {\n  /**\n   * Sale that triggered the capital gains\n   */\n  transactions: Transaction[]\n\n  /**\n   * Capital gains triggered from the sale\n   */\n  capitalGainPerSellDate: number\n}\n\n/**\n * Calculates the FIFO capital gains for the given operation history.\n * It separates capital gains of securities using the symbols given\n * in each operation.\n *\n * @param operationHistory History of operations (buy and sales) to\n * calculate the capital gains for.\n *\n * @throws If the amount of securities of all sell operations of a given symbol\n * exceeds the amount of securities of all buy operations for the same symbol.\n * This indicates that there is an error in the input, since it is not possible\n * to sell more securities than the ones bought.\n *\n * @returns The FIFO capital gains with details of the transaction details\n * for each sell operation\n *\n * [\n    {\n        \"capitalGainPerSellDate\": -315.6,\n        \"transactions\": [\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2019-02-01T00:00:00.000Z\",\n                \"selldate\": \"2020-03-01T00:00:00.000Z\",\n                \"amountsold\": 3,\n                \"transferPrice\": 50,\n                \"profitOrLoss\": -300,\n                \"acquisitionPrice\": 150,\n                \"acquisitionFee\": 4.2,\n                \"transferFee\": 4.1\n            },\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2020-01-01T00:00:00.000Z\",\n                \"selldate\": \"2020-03-01T00:00:00.000Z\",\n                \"amountsold\": 1,\n                \"transferPrice\": 50,\n                \"profitOrLoss\": 0,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 3.2,\n                \"transferFee\": 4.1\n            }\n        ]\n    },\n    {\n        \"capitalGainPerSellDate\": 97.7,\n        \"transactions\": [\n            {\n                \"ticker\": \"GME\",\n                \"buydate\": \"2020-01-01T00:00:00.000Z\",\n                \"selldate\": \"2020-04-01T00:00:00.000Z\",\n                \"amountsold\": 3,\n                \"transferPrice\": 86,\n                \"profitOrLoss\": 108,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 3.2,\n                \"transferFee\": 7.1\n            }\n        ]\n    },\n    {\n        \"capitalGainPerSellDate\": 995.6999999999999,\n        \"transactions\": [\n            {\n                \"ticker\": \"BB\",\n                \"buydate\": \"2020-02-01T00:00:00.000Z\",\n                \"selldate\": \"2021-01-01T00:00:00.000Z\",\n                \"amountsold\": 10,\n                \"transferPrice\": 150,\n                \"profitOrLoss\": 1000,\n                \"acquisitionPrice\": 50,\n                \"acquisitionFee\": 2.2,\n                \"transferFee\": 2.1\n            }\n        ]\n    }\n]\n */\nexport function calculateFIFOCapitalGains(\n  operationHistory: Operation[]\n): CapitalResults[] {\n  const sortedOperationHistory = _.sortBy(operationHistory, o => new Date(o.date))\n  const sales = sortedOperationHistory.filter(({ type }) => type === 'SELL');\n  return sales.reduce<CapitalResults[]>(\n    (capitalGainPerSellDate, sale) => [\n      ...capitalGainPerSellDate,\n      calculateCapitalGainsForSale(sortedOperationHistory, sale),\n    ],\n    []\n  );\n}\n\n/**\n * Calculates the FIFO capital gains for the given operation history. \n * Transfer fees are divided between SELL operations, so the end resulting\n * SELL batch trasnferprice for the bought asset remains the same.\n *\n * @param operationHistory History of operations (buy and sales) to\n * calculate the capital gains for. \n *\n * @returns The FIFO transaction details by every sold security\n * example\n *  {\n        ticker: 'GME',\n        buydate: 2020-01-01T00:00:00.000Z,\n        selldate: 2020-04-01T00:00:00.000Z,\n        amountsold: 3,\n        transferPrice: 86,\n        profitOrLoss: 108,\n        acquisitionPrice: 50,\n        acquisitionFee: 3.2,\n        transferFee: 7.1\n      },\n      {\n        ticker: 'BB',\n        buydate: 2020-02-01T00:00:00.000Z,\n        selldate: 2021-01-01T00:00:00.000Z,\n        amountsold: 10,\n        transferPrice: 150,\n        profitOrLoss: 1000,\n        acquisitionPrice: 50,\n        acquisitionFee: 2.2,\n        transferFee: 2.1\n      }\n *\n */\nexport const calculateFIFOTransactions = (operationHistory: Operation[]): Transaction[] => {\n  const a = calculateFIFOCapitalGains(operationHistory).flatMap((gainByDate) => {\n    const totalAmount = _.sumBy(gainByDate.transactions, (o) => o.amountsold)\n    const dividedFees = gainByDate.transactions.map(x => ({\n      ...x,\n      transferFee: (x.amountsold / totalAmount) * x.transferFee\n    }))\n    const transferFeeForSell = gainByDate.transactions[0] ? gainByDate.transactions[0].transferFee : 0\n    const transferFeeSummedFromSELLOperation = _.sumBy(dividedFees, (o) => o.transferFee)\n    if (transferFeeForSell !== transferFeeSummedFromSELLOperation) {\n      console.warn(`Amount of fees for do not match for ${gainByDate.transactions[0]?.ticker}: ${transferFeeForSell} and ${transferFeeSummedFromSELLOperation}`)\n    }\n    return dividedFees\n  });\n  if (a.length === 0) {\n    throw new Error(\"No SELL transactions found. Have you sold any asset?\")\n  }\n  return a\n}\n\n\nconst calculateCapitalGainsForSale = (\n  operationHistory: Operation[],\n  sale: Operation\n): CapitalResults => {\n  let capitalGainPerSellDate = 0;\n  const transactions: Transaction[] = [];\n  const relatedBuyTransactions = _.orderBy(operationHistory, (o: Operation) => [new Date(o.date), o.type], ['asc', 'desc']).filter(\n    ({ type, symbol, date }) =>\n      type === 'BUY' && symbol === sale.symbol && date <= sale.date\n  );\n\n  // Order the result set in ASC order so the oldest buy operations are handled first\n  relatedBuyTransactions.forEach(\n    (buy) => {\n      const amountSold = Math.min(sale.amount, buy.amount);\n      // if the total amount of held shares have not yet been sold\n      if (amountSold === 0) return;\n      const trs: Transaction = {\n        ticker: sale.symbol,\n        buydate: buy.date,\n        selldate: sale.date,\n        amountsold: amountSold,\n        transferPrice: sale.price,\n        profitOrLoss: amountSold * (sale.price - buy.price),\n        acquisitionPrice: buy.price,\n        acquisitionFee: buy.transactionFee,\n        transferFee: sale.transactionFee,\n      };\n      transactions.push(trs);\n\n      buy.amount -= amountSold;\n      sale.amount -= amountSold;\n      // We reduce the transactionsfees from the capital gain\n      const totalPrice =\n        amountSold * (sale.price - buy.price)\n      capitalGainPerSellDate += totalPrice;\n    }\n  );\n  // TODO: removee nii perkeleesti ja implementoi uudestaan paremmin\n  //if (Number(sale.amount ?  sale.amount.toFixed(6) : 0) > 0) {\n  if (Math.round(sale.amount) > 0) {\n    throw Error(\n      `Amount of sales for ticker ${sale.symbol} exceeds the amount of buys by ${sale.amount}. In transaction made in ${new Date(sale.date)\n        .toLocaleString('en-GB', { timeZone: 'UTC' })}`\n    );\n  }\n\n  return {\n    capitalGainPerSellDate,\n    transactions: transactions,\n  };\n};\n","import React, { ChangeEvent, useEffect, useState } from 'react'\r\nimport { Paper, Stack, styled, Table, TableBody, TableCell, TableContainer, TableHead, TablePagination, TableRow } from '@mui/material';\r\nimport { ColumnDataCrypto, ColumnDataSecurity, columnsCrypto, columnsTransaction, ColumnTransaction, ColumnDataTransaction, columnsSecurity } from './tableSettings'\r\nimport { DataGrid, GridCellEditCommitParams, GridRowsProp } from '@mui/x-data-grid';\r\nimport { rawDatas } from './PreviewData';\r\nimport _ from 'lodash';\r\n\r\ninterface Props {\r\n    rows: ColumnDataSecurity[] | ColumnDataCrypto[],\r\n    mode: 'CRYPTO' | 'SECURITY'\r\n    rawDataAsColumns: ColumnDataSecurity[] | ColumnDataCrypto[],\r\n    rawDatatSetCallback(arg0: ColumnDataSecurity[] | ColumnDataCrypto[]): void\r\n}\r\n\r\nconst PreviewTable = ({ rows, mode, rawDataAsColumns, rawDatatSetCallback }: Props) => {\r\n    const [cellCommit, setCellCommit] = useState({} as any);\r\n\r\n    useEffect(() => {\r\n        if (cellCommit?.row?.id) {\r\n            const matchingRow = rawDataAsColumns.find(y => y.id === cellCommit.row.id)\r\n            const newObj = { ...matchingRow, [cellCommit.field]: cellCommit.value.trim() } as ColumnDataSecurity | ColumnDataCrypto\r\n            const arr = rawDataAsColumns.map(item => item.id === newObj.id ? newObj : item) as ColumnDataSecurity[] | ColumnDataCrypto[]\r\n            rawDatatSetCallback(arr)\r\n        }\r\n    }, [cellCommit])\r\n\r\n    return (\r\n\r\n        <DataGrid\r\n            sx={{\r\n                height: 700,\r\n                '& .font-tabular-nums': {\r\n                    fontVariantNumeric: 'tabular-nums',\r\n                },\r\n                width: 1,\r\n                '& .MuiDataGrid-cell--editing': {\r\n                    bgcolor: 'rgb(255,215,115, 0.19)',\r\n                    color: '#1a3e72',\r\n                },\r\n                '& .Mui-error': {\r\n                    bgcolor: (theme) =>\r\n                        `rgb(126,10,15, ${theme.palette.mode === 'dark' ? 0 : 0.1})`,\r\n                    color: (theme) => (theme.palette.mode === 'dark' ? '#ff4343' : '#750f0f'),\r\n                },\r\n            }}\r\n            rows={rows as GridRowsProp}\r\n            columns={mode === 'CRYPTO' ? columnsCrypto : columnsSecurity}\r\n            onCellEditCommit={(newSelection) => {\r\n                setCellCommit(newSelection);\r\n            }}\r\n        />\r\n\r\n    )\r\n}\r\n\r\nexport { PreviewTable }\r\n","import { useEffect, useState } from 'react'\r\nimport _ from 'lodash';\r\nimport CssBaseline from '@mui/material/CssBaseline';\r\nimport GlobalStyles from '@mui/material/GlobalStyles';\r\nimport Container from '@mui/material/Container';\r\nimport Typography from '@mui/material/Typography';\r\nimport { Alert, Button, createTheme, Stack, ThemeProvider } from '@mui/material';\r\nimport { Dropzone } from './Dropzone';\r\nimport { FileObject } from 'react-mui-dropzone';\r\nimport { Copyright } from './Copyright';\r\nimport { getCoinbaseAsColumns, getDataCoinbase, getDataCoinbasePro, getDataDegiro, getDataNordnet } from '../utils/parsers/loadTransactions'\r\nimport { CoinbaseHeaders, CoinbaseProHeaders, DegiroHeaders, NordnetHeaders } from '../utils/parsers/types';\r\nimport { ResultTable } from './ResultTable'\r\nimport { ResultCard } from './ResultCard'\r\nimport { ColumnDataCrypto, ColumnDataSecurity, ColumnDataTransaction, columnsCrypto, columnsSecurity } from './tableSettings';\r\nimport DeleteIcon from '@mui/icons-material/Delete';\r\nimport SendIcon from '@mui/icons-material/Send';\r\nimport DownloadIcon from '@mui/icons-material/Download';\r\nimport { calculateFIFOTransactions } from '../utils/fifo'\r\nimport { chooseCSVParser, parseColumnDataToFIFO } from '../utils/parsers/helpers'\r\nimport axios from 'axios';\r\nimport moment, { invalid } from 'moment';\r\nimport { PreviewTable } from './PreviewTable'\r\nimport { nanoid } from 'nanoid'\r\n\r\nconst parsersCrypto = [getDataCoinbase, getDataCoinbasePro]\r\nconst parsersSecurity = [getDataDegiro, getDataNordnet]\r\n\r\nexport interface rawDatas {\r\n    Coinbase: CoinbaseHeaders[]\r\n    CoinbasePro: CoinbaseProHeaders[]\r\n    Degiro: DegiroHeaders[]\r\n    Nordnet: NordnetHeaders[]\r\n}\r\n\r\ninterface calculatedResultsType {\r\n    capitalGains: number,\r\n    capitalLosses: number,\r\n    acquisitionFees: number,\r\n    sellprices: number\r\n}\r\n\r\nexport interface resultFromParse {\r\n    orig?: rawDatas\r\n    rows?: ColumnDataSecurity[] | ColumnDataCrypto[]\r\n    Error?: Error\r\n    fileName?: string\r\n}\r\n\r\ninterface Props {\r\n    mode: \"CRYPTO\" | \"SECURITY\"\r\n}\r\n\r\nconst PreviewData = ({ mode }: Props) => {\r\n    const [zoneHeight, setZoneHeight] = useState(400);\r\n    const [files, setFiles] = useState<FileObject[]>([]);\r\n    const [showTable, setShowTable] = useState(false)\r\n\r\n    const [rowDataColumn, setRowDataColumn] = useState<ColumnDataSecurity[] | ColumnDataCrypto[]>([] as any[]);\r\n    const [rawDataAsColumns, setRawDataAsColumns] = useState<ColumnDataSecurity[] | ColumnDataCrypto[]>([] as any[]);\r\n    const [originalData, setOriginalData] = useState<rawDatas>({} as rawDatas);\r\n    const rawDataSetCallback = (newRawData: ColumnDataSecurity[] | ColumnDataCrypto[]) => setRawDataAsColumns(newRawData)\r\n\r\n    const [results, setResults] = useState<ColumnDataTransaction[]>([]);\r\n    const [parseError, setParseError] = useState(\"\")\r\n    const [errorFifo, setErrorFifo] = useState(\"\")\r\n    const [showCurrencyFetchButton, setShowCurrencyFetchButton] = useState(false)\r\n    const [calculatedResults, setCalculatedResults] = useState({} as calculatedResultsType);\r\n\r\n    const fileCallback = (file: FileObject[]) => setFiles([...files, ...file])\r\n\r\n    const clearRows = () => {\r\n        setFiles([])\r\n        setRowDataColumn([])\r\n        setRawDataAsColumns([])\r\n        setOriginalData({} as any)\r\n        setShowTable(false)\r\n        setZoneHeight(400)\r\n        setResults([])\r\n    }\r\n\r\n    const calculateFIFO = () => {\r\n        try {\r\n            const fifoData = parseColumnDataToFIFO(rowDataColumn, originalData)\r\n            const finalFifo = calculateFIFOTransactions(fifoData)\r\n            setResults(finalFifo.map((x, idx) => ({\r\n                ...x,\r\n                buydate: new Date(x.buydate),\r\n                selldate: new Date(x.selldate),\r\n                transferFee: `${Number(x.transferFee)} EUR`,\r\n                profitOrLoss: `${Number(x.profitOrLoss - (Math.abs(x.acquisitionFee) + Math.abs(x.transferFee)))} EUR`,\r\n                id: idx\r\n            })))\r\n\r\n            setCalculatedResults(() => {\r\n                return {\r\n                    capitalGains: _.sumBy(finalFifo, (o) => {\r\n                        const minusFees = o.profitOrLoss - (Math.abs(o.acquisitionFee) + Math.abs(o.transferFee))\r\n                        return minusFees > 0 ? minusFees : 0\r\n                    }),\r\n                    capitalLosses: _.sumBy(finalFifo, (o) => {\r\n                        const minusFees = o.profitOrLoss - (Math.abs(o.acquisitionFee) + Math.abs(o.transferFee))\r\n                        return minusFees < 0 ? minusFees : 0\r\n                    }),\r\n                    acquisitionFees: _.sumBy(finalFifo, (o) => ((o.amountsold * o.acquisitionPrice) + Math.abs(o.acquisitionFee))),\r\n                    sellprices: _.sumBy(finalFifo, (o) => ((o.amountsold * o.transferPrice) - Math.abs(o.transferFee)))\r\n                }\r\n            })\r\n\r\n        } catch (e: any) {\r\n            setErrorFifo(e.message)\r\n        }\r\n    }\r\n\r\n    const currencyClick = () => {\r\n        (async () => {\r\n            const additionlOperationTobeAdded = [] as any[]\r\n            const arrReplacedObj = await Promise.all(rawDataAsColumns.map(async item => {\r\n                const fixedCurrencies = [] as any[]\r\n                if ((item.operation === 'BUY' || item.operation === 'SELL') && item.kokonaissumma.split(' ')[1] !== \"EUR\") {\r\n                    const requestDate = moment(item.paivays).format('YYYY-MM-DD');\r\n                    const unitAsEur = (await (await axios.get(`https://api.coinbase.com/v2/prices/${item.tuote}-EUR/spot?date=${requestDate}`)).data.data)?.amount\r\n                    const percentageOfFee = Number(item.kulut.split(' ')[0]) / Number(item.kokonaissumma.split(' ')[0])\r\n                    const totalInEur = unitAsEur * item.maara\r\n                    const totalFee = totalInEur * percentageOfFee\r\n\r\n                    // Handle sell\r\n                    fixedCurrencies.push({\r\n                        ...item,\r\n                        kurssi: `${unitAsEur} EUR`,\r\n                        kulut: `${totalFee} EUR`,\r\n                        kokonaissumma: `${totalInEur - totalFee} EUR`,\r\n                    })\r\n                    /**\r\n                     * Need to handle Coinbase Pro incorrect currencies as SELL, BUY instead of just sell\r\n                     * SInce most of the entries are just from converting Currency x via uniswap (for example UNI to BTC )\r\n                     */\r\n                    if (originalData['CoinbasePro']?.find(y => y.id === item.id)) {\r\n                        additionlOperationTobeAdded.push({\r\n                            ...item,\r\n                            operation: \"BUY\",\r\n                            id: nanoid(10),\r\n                            tuote: `${item.arvo.split(' ')[1]}`,\r\n                            kurssi: `${unitAsEur} EUR`,\r\n                            kulut: `${0} EUR`, // Only set fees for the other divided transaction\r\n                            kokonaissumma: `${totalInEur - totalFee} EUR`,\r\n                        })\r\n                    }\r\n                }\r\n                const obj = fixedCurrencies.find(newObj => newObj.id === item.id)\r\n                return obj ? obj : item\r\n            }))\r\n            setRawDataAsColumns([...arrReplacedObj.concat(additionlOperationTobeAdded)])\r\n            setRowDataColumn([...arrReplacedObj.concat(additionlOperationTobeAdded)])\r\n            setShowCurrencyFetchButton(false)\r\n            setParseError(\"\")\r\n        })()\r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            if (files.length > 0) {\r\n                const data = (await chooseCSVParser(files, mode === \"CRYPTO\" ? parsersCrypto : parsersSecurity)) as resultFromParse[]\r\n                const successFul = _.uniqBy(data.filter(x => !x.Error), y => y.fileName)\r\n                const errors = _.uniqBy(data.filter(x => x.Error), y => y.fileName)\r\n                if (errors.length > 0 && successFul.length !== errors.length) {\r\n                    const error = errors.find(err => !successFul.map(x => x.fileName).includes(err.fileName))\r\n                    const msg = error?.Error ? error.Error.message : \"\"\r\n                    if (msg.toString().includes('All headers not found in the provided')) {\r\n                        console.error(\"Debug Parser error: \", msg)\r\n                        setParseError(`Error loading headers in ${error?.fileName} Are you tryin to parse in the wrong site?`)\r\n                    } else if (msg === \"malformed URI sequence\") {\r\n                        console.error(\"Debug Parser error: \", msg)\r\n                        setParseError(`Encoding error while trying to parse file ${error?.fileName} are you in the correct place?`)\r\n                    } else if (msg.startsWith(\"Invalid\")) {\r\n                        setParseError(`Parser error while trying to parse file ${error?.fileName} are you in the correct place?`)\r\n                        console.error(\"Debug Parser error: \", msg)\r\n                    } else {\r\n                        console.error(`Debug error in file ${error?.fileName}: ${msg}`)\r\n                        setParseError(msg)\r\n                    }\r\n                }\r\n\r\n                if (successFul.length > 0) {\r\n                    const newRows = data.filter(result => result.rows)\r\n                    setRowDataColumn([...rowDataColumn.concat(...newRows.map(x => x.rows) as any)])\r\n                    // Set row data so if user has edited a field and uploads a new file it's handled correctly\r\n                    setRawDataAsColumns([...rowDataColumn.concat(...newRows.map(x => x.rows) as any)])\r\n                    const newRawData = Object.assign(originalData, ...data.map(result => result.orig))\r\n                    setOriginalData(newRawData)\r\n                    setShowTable(true)\r\n                }\r\n                setFiles([])\r\n            }\r\n        })()\r\n    }, [files])\r\n\r\n    useEffect(() => {\r\n        const enableCurrencyWarning = rowDataColumn\r\n            .find(invalid => invalid?.kokonaissumma?.split(' ')[1] !== 'EUR'\r\n                && (invalid.operation === 'BUY'\r\n                    || invalid.operation === 'SELL'))\r\n        setShowCurrencyFetchButton(!!enableCurrencyWarning && rowDataColumn.length > 0)\r\n    }, [rowDataColumn])\r\n\r\n    useEffect(() => {\r\n        //console.log(\"oring update\", originalData)\r\n    }, [originalData])\r\n\r\n\r\n    useEffect(() => {\r\n        if (parseError.includes(\"In trancactions made in\")) {\r\n            setShowCurrencyFetchButton(true)\r\n        }\r\n    }, [parseError])\r\n\r\n\r\n    const theme = createTheme({\r\n        typography: {\r\n            fontSize: 14,\r\n        }\r\n    });\r\n\r\n    return (\r\n        <ThemeProvider theme={theme}>\r\n            <GlobalStyles styles={{ ul: { margin: 0, padding: 0, listStyle: 'none' } }} />\r\n            <CssBaseline />\r\n            <Container component=\"main\" sx={{ pt: 8, pb: 4 }}>\r\n                <Stack\r\n                    direction=\"column\"\r\n                    justifyContent=\"center\"\r\n                    alignItems=\"center\"\r\n                    spacing={3}\r\n                    width=\"sm\"\r\n\r\n                >\r\n                    <Typography\r\n                        component=\"h1\"\r\n                        variant=\"h3\"\r\n                        align=\"center\"\r\n                        color=\"text.primary\"\r\n                        gutterBottom\r\n                        sx={{ fontWeight: 'bold', pt: 8 }}\r\n                    >\r\n                        VEROTUNKKI\r\n                    </Typography>\r\n                    <Typography alignSelf=\"center\" align=\"center\" variant=\"h6\" sx={{ pt: 0 }} component=\"p\">\r\n                        {mode === 'CRYPTO' ? \"Virtuaalivaluutat\" : \"Arvopaperit\"}\r\n                    </Typography>\r\n                    {parseError && <Alert severity=\"error\">{parseError}</Alert>}\r\n                    {results.length === 0 && <Dropzone zoneHeight={zoneHeight} handleFiles={fileCallback} />}\r\n                    {results.length > 0 &&\r\n                        <Stack direction=\"column\" alignItems=\"center\" justifyContent=\"center\" spacing={2} sx={{ pb: 4 }}>\r\n                            <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"center\" spacing={2}>\r\n                                <ResultCard header=\"Luovutusvoitto\"\r\n                                    content={calculatedResults.capitalGains.toFixed(2)}\r\n                                    footer=\"Voitot\" footerSecondary=\"yhteensä\"\r\n                                    contentColor=\"success.light\"\r\n                                    infoHover='Luovutusvoittoa syntyy tilanteessa, jossa luovutetun omaisuuden myyntihinta ylittää sen hankintamenon ja voiton hankkimisesta aiheutuneet menot.'\r\n                                    infoDirection='left'\r\n                                />\r\n                                <ResultCard header=\"Luovutustappio\"\r\n                                    content={calculatedResults.capitalLosses.toFixed(2)}\r\n                                    footer=\"Häviöt\"\r\n                                    footerSecondary=\"yhteensä\"\r\n                                    contentColor=\"error.light\"\r\n                                    infoHover='Luovutustappiota puolestaan syntyy tilanteessa, jossa luovutetun omaisuuden myyntihinta alittaa sen hankintamenon ja voiton hankkimisesta aiheutuneet menot.'\r\n                                    infoDirection='right'\r\n                                />\r\n                            </Stack>\r\n                            <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"center\" spacing={2}>\r\n                                <ResultCard header=\"Hankintakulut yhteensä\"\r\n                                    content={calculatedResults.acquisitionFees.toFixed(2)}\r\n                                    footer=\"Kulut\" footerSecondary=\"Hankintahinnat + hankinnasta aiheutuneet kulut\"\r\n                                    contentColor=\"error.light\"\r\n                                    infoHover='Arvopaperien hankintakulut eli niiden hankintahinnat ja muut hankinnasta aiheutuneet kulut yhteensä.'\r\n                                    infoDirection='left'\r\n                                />\r\n                                <ResultCard header=\"Myyntihinnat yhteensä\"\r\n                                    content={calculatedResults.sellprices.toFixed(2)}\r\n                                    footer=\"\"\r\n                                    footerSecondary=\"Myyntihinnat - myynnistä aiheutuneet kulut\"\r\n                                    contentColor={calculatedResults.sellprices > 0 ? 'success.light' : 'error.light'}\r\n                                    infoHover='Kaikkien vuoden aikana myymiesi arvopaperien myyntihinnat yhteensä eli myyntihintojen ja myynnistä aiheutuneiden kulujen erotus. Myynnistä aiheutuneita kuluja ovat esimerkiksi välityspalkkiot.'\r\n                                    infoDirection='right'\r\n                                />\r\n                            </Stack>\r\n                        </Stack>}\r\n                    <Typography alignSelf=\"flex-start\" sx={{ pl: 4 }} component=\"p\">\r\n                        {mode === 'CRYPTO' ? \"Tuetut lähteet: Coinbase, Coinbase Pro\" : \"Tuetut lähteet: Nordnet, Degiro\"}\r\n                    </Typography>\r\n                    {errorFifo && <Alert severity=\"error\">{errorFifo}</Alert>}\r\n                    {showCurrencyFetchButton &&\r\n                        <Stack direction=\"row\" alignItems=\"flex-end\" justifyContent=\"center\" spacing={2} sx={{ pb: 1 }}>\r\n                            <Stack direction=\"column\" alignItems=\"center\" justifyContent=\"center\" spacing={2}>\r\n                                <Alert severity=\"warning\" >\r\n                                    You have made transactions that have not been traded in EUR. Do you want to use an <strong>external API</strong> to fetch the currency info?\r\n                                </Alert>\r\n                                <Alert severity=\"info\" >\r\n                                    Note that if the error originated from Coinbase Pro, the currency transfer needs to be converted in to one buy and sell operation.\r\n                                </Alert>\r\n                            </Stack>\r\n                            <div style={{ paddingBottom: \"4px\" }}>\r\n\r\n\r\n                                <Button variant=\"contained\" sx={{ minWidth: \"140px\", minHeight: \"42px\" }} onClick={currencyClick} endIcon={<DownloadIcon />} >I accept</Button>\r\n                            </div>\r\n                        </Stack>}\r\n\r\n                    {showTable && !showCurrencyFetchButton && <Stack direction=\"row\" spacing={2}>\r\n                        <Button variant=\"outlined\" onClick={clearRows} startIcon={<DeleteIcon />}>\r\n                            Poistha\r\n                        </Button>\r\n                        <Button disabled={results.length > 0} onClick={calculateFIFO} variant=\"contained\" endIcon={<SendIcon />}>\r\n                            Laske\r\n                        </Button>\r\n                    </Stack>}\r\n\r\n                    {(showTable && results.length === 0) && <div style={{ width: '100%' }}>\r\n                        <PreviewTable rows={rowDataColumn} mode={mode} rawDataAsColumns={rawDataAsColumns} rawDatatSetCallback={rawDataSetCallback} />\r\n                    </div>}\r\n                    {results.length > 0 && <ResultTable rows={results} mode={mode} />}\r\n                </Stack>\r\n                {<Copyright />}\r\n            </Container>\r\n        </ThemeProvider >\r\n    );\r\n}\r\n\r\nexport { PreviewData }","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Frontpage } from './components/Frontpage'\nimport { BrowserRouter, Route, Routes } from \"react-router-dom\";\nimport { PreviewData } from './components/PreviewData'\nReactDOM.render(\n  <BrowserRouter basename={process.env.PUBLIC_URL}>\n    <Routes>\n      <Route path=\"/\" element={<Frontpage />} />\n      <Route path=\"securities\" element={<PreviewData mode=\"SECURITY\" />} />\n      <Route path=\"crypto\" element={<PreviewData mode=\"CRYPTO\" />} />\n    </Routes>\n  </BrowserRouter>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}